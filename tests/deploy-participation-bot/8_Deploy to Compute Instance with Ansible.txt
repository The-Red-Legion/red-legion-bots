2025-09-06T02:00:37.2178440Z ##[group]Run echo "=== Starting Ansible deployment ==="
2025-09-06T02:00:37.2179160Z [36;1mecho "=== Starting Ansible deployment ==="[0m
2025-09-06T02:00:37.2179745Z [36;1m[0m
2025-09-06T02:00:37.2180258Z [36;1m# Set environment variables for Ansible[0m
2025-09-06T02:00:37.2181115Z [36;1mexport DISCORD_TOKEN=***[0m
2025-09-06T02:00:37.2181706Z [36;1mexport TEXT_CHANNEL_ID=***[0m
2025-09-06T02:00:37.2182563Z [36;1mexport DATABASE_URL=***[0m
2025-09-06T02:00:37.2183298Z [36;1m[0m
2025-09-06T02:00:37.2183791Z [36;1m# Run Ansible playbook[0m
2025-09-06T02:00:37.2184574Z [36;1mDISCORD_TOKEN=*** \[0m
2025-09-06T02:00:37.2185150Z [36;1mTEXT_CHANNEL_ID=*** \[0m
2025-09-06T02:00:37.2185962Z [36;1mDATABASE_URL=*** \[0m
2025-09-06T02:00:37.2186624Z [36;1mansible-playbook ansible/deploy.yml -i ansible/inventory.ini -v[0m
2025-09-06T02:00:37.2187293Z [36;1m[0m
2025-09-06T02:00:37.2187809Z [36;1mecho "=== Ansible deployment completed ==="[0m
2025-09-06T02:00:37.2188391Z [36;1m[0m
2025-09-06T02:00:37.2188938Z [36;1mecho "=== Waiting for bot to stabilize ==="[0m
2025-09-06T02:00:37.2189527Z [36;1msleep 10[0m
2025-09-06T02:00:37.2190056Z [36;1mecho "=== Bot startup wait completed ==="[0m
2025-09-06T02:00:37.2220896Z shell: /usr/bin/bash --noprofile --norc -e -o pipefail ***0***
2025-09-06T02:00:37.2221552Z env:
2025-09-06T02:00:37.2222291Z   DATABASE_URL: ***
2025-09-06T02:00:37.2222864Z   pythonLocation: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T02:00:37.2223845Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.9.23/x64/lib/pkgconfig
2025-09-06T02:00:37.2224576Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T02:00:37.2225251Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T02:00:37.2225916Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T02:00:37.2226583Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.9.23/x64/lib
2025-09-06T02:00:37.2227511Z   CLOUDSDK_AUTH_CREDENTIAL_FILE_OVERRIDE: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-50486cd06a6c0f8b.json
2025-09-06T02:00:37.2228639Z   GOOGLE_APPLICATION_CREDENTIALS: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-50486cd06a6c0f8b.json
2025-09-06T02:00:37.2229685Z   GOOGLE_GHA_CREDS_PATH: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-50486cd06a6c0f8b.json
2025-09-06T02:00:37.2230474Z   CLOUDSDK_CORE_PROJECT: rl-prod-471116
2025-09-06T02:00:37.2231043Z   CLOUDSDK_PROJECT: rl-prod-471116
2025-09-06T02:00:37.2231589Z   GCLOUD_PROJECT: rl-prod-471116
2025-09-06T02:00:37.2232120Z   GCP_PROJECT: rl-prod-471116
2025-09-06T02:00:37.2232651Z   GOOGLE_CLOUD_PROJECT: rl-prod-471116
2025-09-06T02:00:37.2233570Z ##[endgroup]
2025-09-06T02:00:37.2548881Z === Starting Ansible deployment ===
2025-09-06T02:00:38.2323633Z [WARNING]: Invalid characters were found in group names but not replaced, use
2025-09-06T02:00:38.2324902Z -vvvv to see details
2025-09-06T02:00:38.7806081Z Using /home/runner/work/red-legion-bots/red-legion-bots/ansible.cfg as config file
2025-09-06T02:00:38.7806950Z 
2025-09-06T02:00:38.7807537Z PLAY [Deploy Participation Bot] ************************************************
2025-09-06T02:00:38.7808268Z 
2025-09-06T02:00:38.7808780Z TASK [Gathering Facts] *********************************************************
2025-09-06T02:00:41.0621610Z ok: [***]
2025-09-06T02:00:41.0622080Z 
2025-09-06T02:00:41.0622666Z TASK [Update system packages] **************************************************
2025-09-06T02:00:57.6616920Z ok: [***] => ***"changed": false, "msg": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n", "stderr": "", "stderr_lines": [], "stdout": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n", "stdout_lines": ["Reading package lists...", "Building dependency tree...", "Reading state information...", "Calculating upgrade...", "0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded."]***
2025-09-06T02:00:57.6619466Z 
2025-09-06T02:00:57.6619850Z TASK [Install required system packages] ****************************************
2025-09-06T02:01:00.3491032Z ok: [***] => ***"cache_update_time": 1757124044, "cache_updated": false, "changed": false***
2025-09-06T02:01:00.3491875Z 
2025-09-06T02:01:00.3492473Z TASK [Install pip via package manager] *****************************************
2025-09-06T02:01:06.8788421Z ok: [***] => ***"cache_update_time": 1757124064, "cache_updated": true, "changed": false***
2025-09-06T02:01:06.8788986Z 
2025-09-06T02:01:06.8789337Z TASK [Ensure pip3 is in PATH] **************************************************
2025-09-06T02:01:09.3777534Z changed: [***] => ***"changed": true, "cmd": ["pip3", "--version"], "delta": "0:00:01.571700", "end": "2025-09-06 02:01:09.246408", "msg": "", "rc": 0, "start": "2025-09-06 02:01:07.674708", "stderr": "", "stderr_lines": [], "stdout": "pip 22.0.2 from /usr/lib/python3/dist-packages/pip (python 3.10)", "stdout_lines": ["pip 22.0.2 from /usr/lib/python3/dist-packages/pip (python 3.10)"]***
2025-09-06T02:01:09.3779623Z 
2025-09-06T02:01:09.3780186Z TASK [Check if Google Cloud SDK is available] **********************************
2025-09-06T02:01:10.3728441Z changed: [***] => ***"changed": true, "cmd": ["which", "gcloud"], "delta": "0:00:00.015179", "end": "2025-09-06 02:01:10.205165", "msg": "", "rc": 0, "start": "2025-09-06 02:01:10.189986", "stderr": "", "stderr_lines": [], "stdout": "/snap/bin/gcloud", "stdout_lines": ["/snap/bin/gcloud"]***
2025-09-06T02:01:10.3729398Z 
2025-09-06T02:01:10.3729753Z TASK [Install Google Cloud SDK] ************************************************
2025-09-06T02:01:10.3883159Z skipping: [***] => ***"changed": false, "false_condition": "gcloud_check.rc != 0", "skip_reason": "Conditional result was False"***
2025-09-06T02:01:10.3883882Z 
2025-09-06T02:01:10.3884243Z TASK [Stop existing bot process] ***********************************************
2025-09-06T02:01:10.4103262Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/stop_bot.yml for ***
2025-09-06T02:01:10.4103985Z 
2025-09-06T02:01:10.4104434Z TASK [Check if bot PID file exists] ********************************************
2025-09-06T02:01:11.4950108Z ok: [***] => ***"changed": false, "stat": ***"exists": false***
2025-09-06T02:01:11.4950790Z 
2025-09-06T02:01:11.4951312Z TASK [Read PID from file] ******************************************************
2025-09-06T02:01:11.5157673Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T02:01:11.5159487Z 
2025-09-06T02:01:11.5160063Z TASK [Stop existing bot process] ***********************************************
2025-09-06T02:01:11.5376542Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T02:01:11.5378039Z 
2025-09-06T02:01:11.5378616Z TASK [Wait for process to terminate] *******************************************
2025-09-06T02:01:11.5579633Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T02:01:11.5581119Z 
2025-09-06T02:01:11.5581682Z TASK [Force kill if still running] *********************************************
2025-09-06T02:01:11.5794725Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T02:01:11.5796208Z 
2025-09-06T02:01:11.5796745Z TASK [Remove PID file] *********************************************************
2025-09-06T02:01:12.7483872Z ok: [***] => ***"changed": false, "path": "/app/bot.pid", "state": "absent"***
2025-09-06T02:01:12.7484401Z 
2025-09-06T02:01:12.7484784Z TASK [Clean and prepare application directory] *********************************
2025-09-06T02:01:13.8091872Z changed: [***] => ***"changed": true, "path": "/app", "state": "absent"***
2025-09-06T02:01:13.8092473Z 
2025-09-06T02:01:13.8092858Z TASK [Create application directory] ********************************************
2025-09-06T02:01:14.4740819Z changed: [***] => ***"changed": true, "gid": 1000, "group": "ubuntu", "mode": "0755", "owner": "ubuntu", "path": "/app", "size": 4096, "state": "directory", "uid": 1000***
2025-09-06T02:01:14.4741960Z 
2025-09-06T02:01:14.4742517Z TASK [Copy application code] ***************************************************
2025-09-06T02:10:58.8228694Z changed: [***] => ***"changed": true, "dest": "/app/", "src": "/home/runner/work/red-legion-bots/red-legion-bots/"***
2025-09-06T02:10:58.8229696Z 
2025-09-06T02:10:58.8230281Z TASK [Install Python dependencies] *********************************************
2025-09-06T02:11:32.0362790Z ok: [***] => ***"changed": false, "cmd": ["/usr/bin/pip3", "install", "--user", "-r", "/app/requirements.txt"], "name": null, "requirements": "/app/requirements.txt", "state": "present", "stderr": "WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\n", "stderr_lines": ["WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv"], "stdout": "Requirement already satisfied: discord.py==2.4.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 1)) (2.4.0)\nRequirement already satisfied: psycopg2-binary==2.9.9 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 2)) (2.9.9)\nRequirement already satisfied: python-dotenv==1.0.1 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 3)) (1.0.1)\nRequirement already satisfied: google-cloud-secret-manager==2.20.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 4)) (2.20.0)\nRequirement already satisfied: aiohttp==3.9.5 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 5)) (3.9.5)\nRequirement already satisfied: grpc-google-iam-v1<1.0.0dev,>=0.12.4 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.14.2)\nRequirement already satisfied: proto-plus<2.0.0dev,>=1.22.3 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.26.1)\nRequirement already satisfied: protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.25.8)\nRequirement already satisfied: google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)\nRequirement already satisfied: google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.40.3)\nRequirement already satisfied: frozenlist>=1.1.1 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.7.0)\nRequirement already satisfied: multidict<7.0,>=4.5 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (6.6.4)\nRequirement already satisfied: yarl<2.0,>=1.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.20.1)\nRequirement already satisfied: attrs>=17.3.0 in /usr/lib/python3/dist-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (21.2.0)\nRequirement already satisfied: async-timeout<5.0,>=4.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.0.3)\nRequirement already satisfied: aiosignal>=1.1.2 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.4.0)\nRequirement already satisfied: typing-extensions>=4.2 in /root/.local/lib/python3.10/site-packages (from aiosignal>=1.1.2->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.15.0)\nRequirement already satisfied: googleapis-common-protos<2.0.0,>=1.56.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.70.0)\nRequirement already satisfied: requests<3.0.0,>=2.18.0 in /usr/lib/python3/dist-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)\nRequirement already satisfied: grpcio-status<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.62.3)\nRequirement already satisfied: grpcio<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.74.0)\nRequirement already satisfied: cachetools<6.0,>=2.0.0 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (5.5.2)\nRequirement already satisfied: rsa<5,>=3.1.4 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.9.1)\nRequirement already satisfied: pyasn1-modules>=0.2.1 in /usr/lib/python3/dist-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.2.1)\nRequirement already satisfied: propcache>=0.2.1 in /root/.local/lib/python3.10/site-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (0.3.2)\nRequirement already satisfied: idna>=2.0 in /usr/lib/python3/dist-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (3.3)\nRequirement already satisfied: pyasn1>=0.1.3 in /usr/lib/python3/dist-packages (from rsa<5,>=3.1.4->google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.4.8)\n", "stdout_lines": ["Requirement already satisfied: discord.py==2.4.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 1)) (2.4.0)", "Requirement already satisfied: psycopg2-binary==2.9.9 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 2)) (2.9.9)", "Requirement already satisfied: python-dotenv==1.0.1 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 3)) (1.0.1)", "Requirement already satisfied: google-cloud-secret-manager==2.20.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 4)) (2.20.0)", "Requirement already satisfied: aiohttp==3.9.5 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 5)) (3.9.5)", "Requirement already satisfied: grpc-google-iam-v1<1.0.0dev,>=0.12.4 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.14.2)", "Requirement already satisfied: proto-plus<2.0.0dev,>=1.22.3 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.26.1)", "Requirement already satisfied: protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.25.8)", "Requirement already satisfied: google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)", "Requirement already satisfied: google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.40.3)", "Requirement already satisfied: frozenlist>=1.1.1 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.7.0)", "Requirement already satisfied: multidict<7.0,>=4.5 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (6.6.4)", "Requirement already satisfied: yarl<2.0,>=1.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.20.1)", "Requirement already satisfied: attrs>=17.3.0 in /usr/lib/python3/dist-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (21.2.0)", "Requirement already satisfied: async-timeout<5.0,>=4.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.0.3)", "Requirement already satisfied: aiosignal>=1.1.2 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.4.0)", "Requirement already satisfied: typing-extensions>=4.2 in /root/.local/lib/python3.10/site-packages (from aiosignal>=1.1.2->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.15.0)", "Requirement already satisfied: googleapis-common-protos<2.0.0,>=1.56.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.70.0)", "Requirement already satisfied: requests<3.0.0,>=2.18.0 in /usr/lib/python3/dist-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)", "Requirement already satisfied: grpcio-status<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.62.3)", "Requirement already satisfied: grpcio<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.74.0)", "Requirement already satisfied: cachetools<6.0,>=2.0.0 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (5.5.2)", "Requirement already satisfied: rsa<5,>=3.1.4 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.9.1)", "Requirement already satisfied: pyasn1-modules>=0.2.1 in /usr/lib/python3/dist-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.2.1)", "Requirement already satisfied: propcache>=0.2.1 in /root/.local/lib/python3.10/site-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (0.3.2)", "Requirement already satisfied: idna>=2.0 in /usr/lib/python3/dist-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (3.3)", "Requirement already satisfied: pyasn1>=0.1.3 in /usr/lib/python3/dist-packages (from rsa<5,>=3.1.4->google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.4.8)"], "version": null, "virtualenv": null***
2025-09-06T02:11:32.0423632Z 
2025-09-06T02:11:32.0424043Z TASK [Install additional packages] *********************************************
2025-09-06T02:11:44.0224623Z ok: [***] => ***"changed": false, "cmd": ["/usr/bin/pip3", "install", "--user", "psycopg2-binary"], "name": ["psycopg2-binary"], "requirements": null, "state": "present", "stderr": "WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\n", "stderr_lines": ["WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv"], "stdout": "Requirement already satisfied: psycopg2-binary in /root/.local/lib/python3.10/site-packages (2.9.9)\n", "stdout_lines": ["Requirement already satisfied: psycopg2-binary in /root/.local/lib/python3.10/site-packages (2.9.9)"], "version": null, "virtualenv": null***
2025-09-06T02:11:44.0229729Z 
2025-09-06T02:11:44.0230276Z TASK [Set up environment variables] ********************************************
2025-09-06T02:11:44.0469906Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/setup_environment.yml for ***
2025-09-06T02:11:44.0470831Z 
2025-09-06T02:11:44.0471317Z TASK [Create .env file] ********************************************************
2025-09-06T02:11:49.5804092Z changed: [***] => ***"changed": true, "checksum": "a974a4f3ee2ec4647427d36713d12cb9940147b7", "dest": "/app/.env", "gid": 1000, "group": "ubuntu", "md5sum": "87eb36bf35058f17fde58db0ef954cb3", "mode": "0600", "owner": "ubuntu", "size": 252, "src": "/home/ubuntu/.ansible/tmp/ansible-tmp-1757124704.2835855-3738-124659214142760/source", "state": "file", "uid": 1000***
2025-09-06T02:11:49.5805827Z 
2025-09-06T02:11:49.5806229Z TASK [Set PYTHONPATH environment variable] *************************************
2025-09-06T02:11:52.5710115Z ok: [***] => ***"backup": "", "changed": false, "msg": ""***
2025-09-06T02:11:52.5710826Z 
2025-09-06T02:11:52.5711361Z TASK [Test Python imports] *****************************************************
2025-09-06T02:12:06.0833481Z changed: [***] => ***"changed": true, "cmd": ["python3", "-c", "import sys; print('Python path:', sys.path); import src.participation_bot"], "delta": "0:00:10.287946", "end": "2025-09-06 02:12:05.788149", "failed_when_result": false, "msg": "", "rc": 0, "start": "2025-09-06 02:11:55.500203", "stderr": "", "stderr_lines": [], "stdout": "Python path: ['', '/app', '/app/$PYTHONPATH', '/usr/lib/python310.zip', '/usr/lib/python3.10', '/usr/lib/python3.10/lib-dynload', '/root/.local/lib/python3.10/site-packages', '/usr/local/lib/python3.10/dist-packages', '/usr/lib/python3/dist-packages']\nWarning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value", "stdout_lines": ["Python path: ['', '/app', '/app/$PYTHONPATH', '/usr/lib/python310.zip', '/usr/lib/python3.10', '/usr/lib/python3.10/lib-dynload', '/root/.local/lib/python3.10/site-packages', '/usr/local/lib/python3.10/dist-packages', '/usr/lib/python3/dist-packages']", "Warning: GITHUB_TOKEN not set or using dummy value", "Warning: WEBHOOK_URL not set or using default value", "Warning: UEX_API_KEY not set or using dummy value"]***
2025-09-06T02:12:06.0838947Z 
2025-09-06T02:12:06.0839372Z TASK [Start bot service] *******************************************************
2025-09-06T02:12:06.1109312Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/start_bot.yml for ***
2025-09-06T02:12:06.1110086Z 
2025-09-06T02:12:14.7726156Z TASK [Test Python imports before starting bot] *********************************
2025-09-06T02:12:14.7729061Z changed: [***] => ***"changed": true, "cmd": ["python3", "-c", "import src.participation_bot; print('Import successful')"], "delta": "0:00:05.474219", "end": "2025-09-06 02:12:14.504237", "msg": "", "rc": 0, "start": "2025-09-06 02:12:09.030018", "stderr": "", "stderr_lines": [], "stdout": "Warning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value\nImport successful", "stdout_lines": ["Warning: GITHUB_TOKEN not set or using dummy value", "Warning: WEBHOOK_URL not set or using default value", "Warning: UEX_API_KEY not set or using dummy value", "Import successful"]***
2025-09-06T02:12:14.7731244Z 
2025-09-06T02:12:14.7731597Z TASK [Show import test result] *************************************************
2025-09-06T02:12:14.7989830Z ok: [***] => ***
2025-09-06T02:12:14.7991531Z     "msg": "Import test result: Warning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value\nImport successful"
2025-09-06T02:12:14.7993459Z ***
2025-09-06T02:12:14.7993837Z 
2025-09-06T02:12:14.7994468Z TASK [Start bot process] *******************************************************
2025-09-06T02:12:21.7814190Z changed: [***] => ***"changed": true, "cmd": "#!/bin/bash\ncd /app\nexport PYTHONPATH=\"/app:$PYTHONPATH\"\n\n# Load environment variables from .env file\nif [ -f .env ]; then\n  set -a  # automatically export all variables\n  . .env  # use . instead of source for compatibility\n  set +a\nfi\n\necho \"Starting bot with environment:\"\necho \"DISCORD_TOKEN: $***DISCORD_TOKEN:0:10***...\"\necho \"DATABASE_URL: $***DATABASE_URL:0:20***...\"\necho \"TEXT_CHANNEL_ID: $TEXT_CHANNEL_ID\"\necho \"PYTHONPATH: $PYTHONPATH\"\n\nnohup python3 -m src.participation_bot > /app/bot.log 2>&1 &\nBOT_PID=$!\necho $BOT_PID > /app/bot.pid\necho \"Bot started with PID: $BOT_PID\"\nsleep 2\n\nif kill -0 $BOT_PID 2>/dev/null; then\n  echo \"Bot process is running\"\nelse\n  echo \"Bot process failed to start or died immediately\"\n  if [ -f /app/bot.log ]; then\n    echo \"Bot log contents:\"\n    cat /app/bot.log\n  fi\nfi\n", "delta": "0:00:02.038717", "end": "2025-09-06 02:12:19.540241", "msg": "", "rc": 0, "start": "2025-09-06 02:12:17.501524", "stderr": "", "stderr_lines": [], "stdout": "Starting bot with environment:\nDISCORD_TOKEN: MTQxMTc4ND...\nDATABASE_URL: postgresql://event_u...\nTEXT_CHANNEL_ID: ***\nPYTHONPATH: /app:/app:$PYTHONPATH\nBot started with PID: 15164\nBot process is running", "stdout_lines": ["Starting bot with environment:", "DISCORD_TOKEN: MTQxMTc4ND...", "DATABASE_URL: postgresql://event_u...", "TEXT_CHANNEL_ID: ***", "PYTHONPATH: /app:/app:$PYTHONPATH", "Bot started with PID: 15164", "Bot process is running"]***
2025-09-06T02:12:21.7824627Z 
2025-09-06T02:12:21.7825218Z TASK [Show startup debug info] *************************************************
2025-09-06T02:12:21.8100559Z ok: [***] => ***
2025-09-06T02:12:21.8101429Z     "msg": [
2025-09-06T02:12:21.8102277Z         "Starting bot with environment:",
2025-09-06T02:12:21.8103497Z         "DISCORD_TOKEN: MTQxMTc4ND...",
2025-09-06T02:12:21.8104151Z         "DATABASE_URL: postgresql://event_u...",
2025-09-06T02:12:21.8104802Z         "TEXT_CHANNEL_ID: ***",
2025-09-06T02:12:21.8105375Z         "PYTHONPATH: /app:/app:$PYTHONPATH",
2025-09-06T02:12:21.8105978Z         "Bot started with PID: 15164",
2025-09-06T02:12:21.8106885Z         "Bot process is running"
2025-09-06T02:12:21.8107397Z     ]
2025-09-06T02:12:21.8107857Z ***
2025-09-06T02:12:21.8108096Z 
2025-09-06T02:12:21.8108430Z TASK [Wait for bot to start] ***************************************************
2025-09-06T02:12:24.8343612Z Pausing for 3 seconds
2025-09-06T02:12:24.8345264Z ok: [***] => ***"changed": false, "delta": 3, "echo": true, "rc": 0, "start": "2025-09-06 02:12:21.822833", "stderr": "", "stdout": "Paused for 3.0 seconds", "stop": "2025-09-06 02:12:24.824938", "user_input": ""***
2025-09-06T02:12:24.8346442Z 
2025-09-06T02:12:24.8347013Z TASK [Verify bot process is running] *******************************************
2025-09-06T02:12:27.1138835Z changed: [***] => ***"changed": true, "cmd": "#!/bin/bash\nif [ -f \"/app/bot.pid\" ]; then\n  kill -0 $(cat /app/bot.pid) 2>/dev/null\nelse\n  exit 1\nfi\n", "delta": "0:00:00.016435", "end": "2025-09-06 02:12:26.815420", "failed_when_result": false, "msg": "", "rc": 0, "start": "2025-09-06 02:12:26.798985", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []***
2025-09-06T02:12:27.1140082Z 
2025-09-06T02:12:27.1140446Z TASK [Show bot log if startup failed] ******************************************
2025-09-06T02:12:27.1660484Z skipping: [***] => ***"changed": false, "false_condition": "(bot_check is defined and (bot_check.rc | default(0)) != 0 and not ansible_check_mode) or (ansible_check_mode and false)", "skip_reason": "Conditional result was False"***
2025-09-06T02:12:27.1661444Z 
2025-09-06T02:12:27.1661792Z TASK [Fail with bot log] *******************************************************
2025-09-06T02:12:27.1978229Z skipping: [***] => ***"changed": false, "false_condition": "(bot_check is defined and (bot_check.rc | default(0)) != 0 and not ansible_check_mode) or (ansible_check_mode and false)", "skip_reason": "Conditional result was False"***
2025-09-06T02:12:27.1979761Z 
2025-09-06T02:12:27.1980283Z TASK [Verify bot is running] ***************************************************
2025-09-06T02:12:27.2255907Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/verify_bot.yml for ***
2025-09-06T02:12:27.2256900Z 
2025-09-06T02:12:27.2257456Z TASK [Check if bot PID file exists] ********************************************
2025-09-06T02:12:30.3397984Z ok: [***] => ***"changed": false, "stat": ***"atime": 1757124746.8133578, "attr_flags": "e", "attributes": ["extents"], "block_size": 4096, "blocks": 8, "charset": "us-ascii", "checksum": "8df4e752ab06671e8fccc243430e0a1a8a997583", "ctime": 1757124737.5115988, "dev": 2049, "device_type": 0, "executable": false, "exists": true, "gid": 0, "gr_name": "root", "inode": 1032261, "isblk": false, "ischr": false, "isdir": false, "isfifo": false, "isgid": false, "islnk": false, "isreg": true, "issock": false, "isuid": false, "mimetype": "text/plain", "mode": "0644", "mtime": 1757124737.5115988, "nlink": 1, "path": "/app/bot.pid", "pw_name": "root", "readable": true, "rgrp": true, "roth": true, "rusr": true, "size": 6, "uid": 0, "version": "315410950", "wgrp": false, "woth": false, "writeable": true, "wusr": true, "xgrp": false, "xoth": false, "xusr": false***
2025-09-06T02:12:30.3400965Z 
2025-09-06T02:12:30.3401327Z TASK [Verify bot process is running] *******************************************
2025-09-06T02:12:33.3425186Z changed: [***] => ***"changed": true, "cmd": "kill -0 $(cat /app/bot.pid)", "delta": "0:00:00.007543", "end": "2025-09-06 02:12:33.044742", "failed_when_result": false, "msg": "", "rc": 0, "start": "2025-09-06 02:12:33.037199", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []***
2025-09-06T02:12:33.3426797Z 
2025-09-06T02:12:33.3427340Z TASK [Check bot log for errors] ************************************************
2025-09-06T02:12:36.5617122Z changed: [***] => ***"changed": true, "cmd": ["tail", "-20", "/app/bot.log"], "delta": "0:00:00.009472", "end": "2025-09-06 02:12:36.277570", "msg": "", "rc": 0, "start": "2025-09-06 02:12:36.268098", "stderr": "", "stderr_lines": [], "stdout": "[2025-09-06 02:12:22] [INFO    ] discord.client: logging in using static token\n[2025-09-06 02:12:23] [INFO    ] discord.gateway: Shard ID None has connected to Gateway (Session ID: f9db1e0e4d86916cdba1e92d77b217f6).", "stdout_lines": ["[2025-09-06 02:12:22] [INFO    ] discord.client: logging in using static token", "[2025-09-06 02:12:23] [INFO    ] discord.gateway: Shard ID None has connected to Gateway (Session ID: f9db1e0e4d86916cdba1e92d77b217f6)."]***
2025-09-06T02:12:36.5620907Z 
2025-09-06T02:12:36.5621461Z TASK [Display recent log entries] **********************************************
2025-09-06T02:12:36.5868950Z ok: [***] => ***
2025-09-06T02:12:36.5870711Z     "msg": "[2025-09-06 02:12:22] [INFO    ] discord.client: logging in using static token\n[2025-09-06 02:12:23] [INFO    ] discord.gateway: Shard ID None has connected to Gateway (Session ID: f9db1e0e4d86916cdba1e92d77b217f6)."
2025-09-06T02:12:36.5872472Z ***
2025-09-06T02:12:36.5872863Z 
2025-09-06T02:12:36.5873605Z TASK [Check for error patterns in log] *****************************************
2025-09-06T02:12:39.6076016Z changed: [***] => ***"changed": true, "cmd": "grep -i \"ERROR\\|Exception\\|Failed\" /app/bot.log", "delta": "0:00:00.018579", "end": "2025-09-06 02:12:39.312867", "failed_when_result": false, "msg": "non-zero return code", "rc": 1, "start": "2025-09-06 02:12:39.294288", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []***
2025-09-06T02:12:39.6077154Z 
2025-09-06T02:12:39.6077490Z TASK [Read PID from file] ******************************************************
2025-09-06T02:12:42.3671953Z ok: [***] => ***"changed": false, "content": "MTUxNjQK", "encoding": "base64", "source": "/app/bot.pid"***
2025-09-06T02:12:42.3672852Z 
2025-09-06T02:12:42.3673615Z TASK [Report successful deployment] ********************************************
2025-09-06T02:12:42.4058934Z ok: [***] => ***
2025-09-06T02:12:42.4060175Z     "msg": "✅ Bot deployment successful! PID: 15164"
2025-09-06T02:12:42.4061104Z ***
2025-09-06T02:12:42.4061516Z 
2025-09-06T02:12:42.4062056Z TASK [Clean up temporary files] ************************************************
2025-09-06T02:12:51.3135832Z changed: [***] => (item=/app/.git) => ***"ansible_loop_var": "item", "changed": true, "item": "/app/.git", "path": "/app/.git", "state": "absent"***
2025-09-06T02:12:51.3137807Z changed: [***] => (item=/app/ansible) => ***"ansible_loop_var": "item", "changed": true, "item": "/app/ansible", "path": "/app/ansible", "state": "absent"***
2025-09-06T02:12:51.3139787Z changed: [***] => (item=/app/tests) => ***"ansible_loop_var": "item", "changed": true, "item": "/app/tests", "path": "/app/tests", "state": "absent"***
2025-09-06T02:12:51.3141209Z 
2025-09-06T02:12:51.3141734Z PLAY RECAP *********************************************************************
2025-09-06T02:12:51.3143291Z ***               : ok=34   changed=14   unreachable=0    failed=0    skipped=7    rescued=0    ignored=0   
2025-09-06T02:12:51.3144090Z 
2025-09-06T02:12:51.3663603Z === Ansible deployment completed ===
2025-09-06T02:12:51.3664359Z === Waiting for bot to stabilize ===
2025-09-06T02:13:01.3685500Z === Bot startup wait completed ===
