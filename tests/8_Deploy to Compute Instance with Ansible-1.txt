2025-09-06T00:27:43.4435226Z ##[group]Run echo "=== Starting Ansible deployment ==="
2025-09-06T00:27:43.4435922Z [36;1mecho "=== Starting Ansible deployment ==="[0m
2025-09-06T00:27:43.4436471Z [36;1m[0m
2025-09-06T00:27:43.4436943Z [36;1m# Set environment variables for Ansible[0m
2025-09-06T00:27:43.4437779Z [36;1mexport DISCORD_TOKEN=***[0m
2025-09-06T00:27:43.4438324Z [36;1mexport TEXT_CHANNEL_ID=***[0m
2025-09-06T00:27:43.4439121Z [36;1mexport DATABASE_URL=***[0m
2025-09-06T00:27:43.4439859Z [36;1m[0m
2025-09-06T00:27:43.4440302Z [36;1m# Run Ansible playbook[0m
2025-09-06T00:27:43.4441051Z [36;1mDISCORD_TOKEN=*** \[0m
2025-09-06T00:27:43.4441567Z [36;1mTEXT_CHANNEL_ID=*** \[0m
2025-09-06T00:27:43.4442333Z [36;1mDATABASE_URL=*** \[0m
2025-09-06T00:27:43.4442941Z [36;1mansible-playbook ansible/deploy.yml -i ansible/inventory.ini -v[0m
2025-09-06T00:27:43.4443563Z [36;1m[0m
2025-09-06T00:27:43.4444031Z [36;1mecho "=== Ansible deployment completed ==="[0m
2025-09-06T00:27:43.4444565Z [36;1m[0m
2025-09-06T00:27:43.4445047Z [36;1mecho "=== Waiting for bot to stabilize ==="[0m
2025-09-06T00:27:43.4445576Z [36;1msleep 10[0m
2025-09-06T00:27:43.4446067Z [36;1mecho "=== Bot startup wait completed ==="[0m
2025-09-06T00:27:43.4475434Z shell: /usr/bin/bash --noprofile --norc -e -o pipefail ***0***
2025-09-06T00:27:43.4476059Z env:
2025-09-06T00:27:43.4476732Z   DATABASE_URL: ***
2025-09-06T00:27:43.4477265Z   pythonLocation: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T00:27:43.4477948Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.9.23/x64/lib/pkgconfig
2025-09-06T00:27:43.4478613Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T00:27:43.4479233Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T00:27:43.4480118Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T00:27:43.4480749Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.9.23/x64/lib
2025-09-06T00:27:43.4481617Z   CLOUDSDK_AUTH_CREDENTIAL_FILE_OVERRIDE: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-f0e30db9ea7e1539.json
2025-09-06T00:27:43.4482672Z   GOOGLE_APPLICATION_CREDENTIALS: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-f0e30db9ea7e1539.json
2025-09-06T00:27:43.4483669Z   GOOGLE_GHA_CREDS_PATH: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-f0e30db9ea7e1539.json
2025-09-06T00:27:43.4484404Z   CLOUDSDK_CORE_PROJECT: rl-prod-471116
2025-09-06T00:27:43.4484921Z   CLOUDSDK_PROJECT: rl-prod-471116
2025-09-06T00:27:43.4485426Z   GCLOUD_PROJECT: rl-prod-471116
2025-09-06T00:27:43.4485918Z   GCP_PROJECT: rl-prod-471116
2025-09-06T00:27:43.4486402Z   GOOGLE_CLOUD_PROJECT: rl-prod-471116
2025-09-06T00:27:43.4487055Z ##[endgroup]
2025-09-06T00:27:43.4538891Z === Starting Ansible deployment ===
2025-09-06T00:27:44.0925492Z [WARNING]: Invalid characters were found in group names but not replaced, use
2025-09-06T00:27:44.0926702Z -vvvv to see details
2025-09-06T00:27:44.3223392Z Using /home/runner/work/red-legion-bots/red-legion-bots/ansible.cfg as config file
2025-09-06T00:27:44.3224076Z 
2025-09-06T00:27:44.3224435Z PLAY [Deploy Participation Bot] ************************************************
2025-09-06T00:27:44.3224886Z 
2025-09-06T00:27:44.3225197Z TASK [Gathering Facts] *********************************************************
2025-09-06T00:27:48.2110382Z ok: [***]
2025-09-06T00:27:48.2110719Z 
2025-09-06T00:27:48.2111086Z TASK [Update system packages] **************************************************
2025-09-06T00:27:55.8085745Z ok: [***] => ***"changed": false, "msg": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n", "stderr": "", "stderr_lines": [], "stdout": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n", "stdout_lines": ["Reading package lists...", "Building dependency tree...", "Reading state information...", "Calculating upgrade...", "0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded."]***
2025-09-06T00:27:55.8088735Z 
2025-09-06T00:27:55.8089125Z TASK [Install required system packages] ****************************************
2025-09-06T00:27:58.7240884Z ok: [***] => ***"cache_update_time": 1757118473, "cache_updated": false, "changed": false***
2025-09-06T00:27:58.7241493Z 
2025-09-06T00:27:58.7241873Z TASK [Install pip via package manager] *****************************************
2025-09-06T00:28:03.8711130Z ok: [***] => ***"cache_update_time": 1757118482, "cache_updated": true, "changed": false***
2025-09-06T00:28:03.8711956Z 
2025-09-06T00:28:03.8712455Z TASK [Ensure pip3 is in PATH] **************************************************
2025-09-06T00:28:06.0016655Z changed: [***] => ***"changed": true, "cmd": ["pip3", "--version"], "delta": "0:00:00.501857", "end": "2025-09-06 00:28:05.813980", "msg": "", "rc": 0, "start": "2025-09-06 00:28:05.312123", "stderr": "", "stderr_lines": [], "stdout": "pip 22.0.2 from /usr/lib/python3/dist-packages/pip (python 3.10)", "stdout_lines": ["pip 22.0.2 from /usr/lib/python3/dist-packages/pip (python 3.10)"]***
2025-09-06T00:28:06.0017948Z 
2025-09-06T00:28:06.0018295Z TASK [Check if Google Cloud SDK is available] **********************************
2025-09-06T00:28:07.5693842Z changed: [***] => ***"changed": true, "cmd": ["which", "gcloud"], "delta": "0:00:00.035719", "end": "2025-09-06 00:28:07.378001", "msg": "", "rc": 0, "start": "2025-09-06 00:28:07.342282", "stderr": "", "stderr_lines": [], "stdout": "/snap/bin/gcloud", "stdout_lines": ["/snap/bin/gcloud"]***
2025-09-06T00:28:07.5695356Z 
2025-09-06T00:28:07.5695875Z TASK [Install Google Cloud SDK] ************************************************
2025-09-06T00:28:07.5858336Z skipping: [***] => ***"changed": false, "false_condition": "gcloud_check.rc != 0", "skip_reason": "Conditional result was False"***
2025-09-06T00:28:07.5859340Z 
2025-09-06T00:28:07.5860071Z TASK [Stop existing bot process] ***********************************************
2025-09-06T00:28:07.6084162Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/stop_bot.yml for ***
2025-09-06T00:28:07.6085081Z 
2025-09-06T00:28:07.6085623Z TASK [Check if bot PID file exists] ********************************************
2025-09-06T00:28:09.1496558Z ok: [***] => ***"changed": false, "stat": ***"exists": false***
2025-09-06T00:28:09.1497103Z 
2025-09-06T00:28:09.1497484Z TASK [Read PID from file] ******************************************************
2025-09-06T00:28:09.1715501Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T00:28:09.1716683Z 
2025-09-06T00:28:09.1717034Z TASK [Stop existing bot process] ***********************************************
2025-09-06T00:28:09.1935939Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T00:28:09.1936929Z 
2025-09-06T00:28:09.1937287Z TASK [Wait for process to terminate] *******************************************
2025-09-06T00:28:09.2142420Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T00:28:09.2143298Z 
2025-09-06T00:28:09.2143635Z TASK [Force kill if still running] *********************************************
2025-09-06T00:28:09.2348298Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T00:28:09.2349187Z 
2025-09-06T00:28:09.2349761Z TASK [Remove PID file] *********************************************************
2025-09-06T00:28:10.7671123Z ok: [***] => ***"changed": false, "path": "/app/bot.pid", "state": "absent"***
2025-09-06T00:28:10.7671852Z 
2025-09-06T00:28:10.7672425Z TASK [Clean and prepare application directory] *********************************
2025-09-06T00:28:12.1980097Z changed: [***] => ***"changed": true, "path": "/app", "state": "absent"***
2025-09-06T00:28:12.1981222Z 
2025-09-06T00:28:12.1981999Z TASK [Create application directory] ********************************************
2025-09-06T00:28:13.6147557Z changed: [***] => ***"changed": true, "gid": 1000, "group": "ubuntu", "mode": "0755", "owner": "ubuntu", "path": "/app", "size": 4096, "state": "directory", "uid": 1000***
2025-09-06T00:28:13.6148531Z 
2025-09-06T00:28:13.6149001Z TASK [Copy application code] ***************************************************
2025-09-06T00:34:55.2808453Z changed: [***] => ***"changed": true, "dest": "/app/", "src": "/home/runner/work/red-legion-bots/red-legion-bots/"***
2025-09-06T00:34:55.2809056Z 
2025-09-06T00:34:55.2809618Z TASK [Install Python dependencies] *********************************************
2025-09-06T00:34:59.9432433Z ok: [***] => ***"changed": false, "cmd": ["/usr/bin/pip3", "install", "--user", "-r", "/app/requirements.txt"], "name": null, "requirements": "/app/requirements.txt", "state": "present", "stderr": "WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\n", "stderr_lines": ["WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv"], "stdout": "Requirement already satisfied: discord.py==2.4.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 1)) (2.4.0)\nRequirement already satisfied: psycopg2-binary==2.9.9 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 2)) (2.9.9)\nRequirement already satisfied: python-dotenv==1.0.1 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 3)) (1.0.1)\nRequirement already satisfied: google-cloud-secret-manager==2.20.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 4)) (2.20.0)\nRequirement already satisfied: aiohttp==3.9.5 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 5)) (3.9.5)\nRequirement already satisfied: grpc-google-iam-v1<1.0.0dev,>=0.12.4 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.14.2)\nRequirement already satisfied: proto-plus<2.0.0dev,>=1.22.3 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.26.1)\nRequirement already satisfied: protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.25.8)\nRequirement already satisfied: google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)\nRequirement already satisfied: google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.40.3)\nRequirement already satisfied: attrs>=17.3.0 in /usr/lib/python3/dist-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (21.2.0)\nRequirement already satisfied: aiosignal>=1.1.2 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.4.0)\nRequirement already satisfied: yarl<2.0,>=1.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.20.1)\nRequirement already satisfied: multidict<7.0,>=4.5 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (6.6.4)\nRequirement already satisfied: async-timeout<5.0,>=4.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.0.3)\nRequirement already satisfied: frozenlist>=1.1.1 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.7.0)\nRequirement already satisfied: typing-extensions>=4.2 in /root/.local/lib/python3.10/site-packages (from aiosignal>=1.1.2->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.15.0)\nRequirement already satisfied: requests<3.0.0,>=2.18.0 in /usr/lib/python3/dist-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)\nRequirement already satisfied: googleapis-common-protos<2.0.0,>=1.56.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.70.0)\nRequirement already satisfied: grpcio<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.74.0)\nRequirement already satisfied: grpcio-status<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.62.3)\nRequirement already satisfied: pyasn1-modules>=0.2.1 in /usr/lib/python3/dist-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.2.1)\nRequirement already satisfied: rsa<5,>=3.1.4 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.9.1)\nRequirement already satisfied: cachetools<6.0,>=2.0.0 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (5.5.2)\nRequirement already satisfied: idna>=2.0 in /usr/lib/python3/dist-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (3.3)\nRequirement already satisfied: propcache>=0.2.1 in /root/.local/lib/python3.10/site-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (0.3.2)\nRequirement already satisfied: pyasn1>=0.1.3 in /usr/lib/python3/dist-packages (from rsa<5,>=3.1.4->google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.4.8)\n", "stdout_lines": ["Requirement already satisfied: discord.py==2.4.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 1)) (2.4.0)", "Requirement already satisfied: psycopg2-binary==2.9.9 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 2)) (2.9.9)", "Requirement already satisfied: python-dotenv==1.0.1 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 3)) (1.0.1)", "Requirement already satisfied: google-cloud-secret-manager==2.20.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 4)) (2.20.0)", "Requirement already satisfied: aiohttp==3.9.5 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 5)) (3.9.5)", "Requirement already satisfied: grpc-google-iam-v1<1.0.0dev,>=0.12.4 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.14.2)", "Requirement already satisfied: proto-plus<2.0.0dev,>=1.22.3 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.26.1)", "Requirement already satisfied: protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.25.8)", "Requirement already satisfied: google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)", "Requirement already satisfied: google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.40.3)", "Requirement already satisfied: attrs>=17.3.0 in /usr/lib/python3/dist-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (21.2.0)", "Requirement already satisfied: aiosignal>=1.1.2 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.4.0)", "Requirement already satisfied: yarl<2.0,>=1.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.20.1)", "Requirement already satisfied: multidict<7.0,>=4.5 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (6.6.4)", "Requirement already satisfied: async-timeout<5.0,>=4.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.0.3)", "Requirement already satisfied: frozenlist>=1.1.1 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.7.0)", "Requirement already satisfied: typing-extensions>=4.2 in /root/.local/lib/python3.10/site-packages (from aiosignal>=1.1.2->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.15.0)", "Requirement already satisfied: requests<3.0.0,>=2.18.0 in /usr/lib/python3/dist-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)", "Requirement already satisfied: googleapis-common-protos<2.0.0,>=1.56.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.70.0)", "Requirement already satisfied: grpcio<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.74.0)", "Requirement already satisfied: grpcio-status<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.62.3)", "Requirement already satisfied: pyasn1-modules>=0.2.1 in /usr/lib/python3/dist-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.2.1)", "Requirement already satisfied: rsa<5,>=3.1.4 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.9.1)", "Requirement already satisfied: cachetools<6.0,>=2.0.0 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (5.5.2)", "Requirement already satisfied: idna>=2.0 in /usr/lib/python3/dist-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (3.3)", "Requirement already satisfied: propcache>=0.2.1 in /root/.local/lib/python3.10/site-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (0.3.2)", "Requirement already satisfied: pyasn1>=0.1.3 in /usr/lib/python3/dist-packages (from rsa<5,>=3.1.4->google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.4.8)"], "version": null, "virtualenv": null***
2025-09-06T00:34:59.9473293Z 
2025-09-06T00:34:59.9473662Z TASK [Install additional packages] *********************************************
2025-09-06T00:35:02.6233355Z ok: [***] => ***"changed": false, "cmd": ["/usr/bin/pip3", "install", "--user", "psycopg2-binary"], "name": ["psycopg2-binary"], "requirements": null, "state": "present", "stderr": "WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\n", "stderr_lines": ["WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv"], "stdout": "Requirement already satisfied: psycopg2-binary in /root/.local/lib/python3.10/site-packages (2.9.9)\n", "stdout_lines": ["Requirement already satisfied: psycopg2-binary in /root/.local/lib/python3.10/site-packages (2.9.9)"], "version": null, "virtualenv": null***
2025-09-06T00:35:02.6238518Z 
2025-09-06T00:35:02.6239156Z TASK [Set up environment variables] ********************************************
2025-09-06T00:35:02.6467041Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/setup_environment.yml for ***
2025-09-06T00:35:02.6468027Z 
2025-09-06T00:35:02.6468523Z TASK [Create .env file] ********************************************************
2025-09-06T00:35:05.7987813Z changed: [***] => ***"changed": true, "checksum": "a974a4f3ee2ec4647427d36713d12cb9940147b7", "dest": "/app/.env", "gid": 1000, "group": "ubuntu", "md5sum": "87eb36bf35058f17fde58db0ef954cb3", "mode": "0600", "owner": "ubuntu", "size": 252, "src": "/home/ubuntu/.ansible/tmp/ansible-tmp-1757118902.7708356-3589-251193177559967/source", "state": "file", "uid": 1000***
2025-09-06T00:35:05.7989706Z 
2025-09-06T00:35:05.7990076Z TASK [Set PYTHONPATH environment variable] *************************************
2025-09-06T00:35:07.2869668Z ok: [***] => ***"backup": "", "changed": false, "msg": ""***
2025-09-06T00:35:07.2870358Z 
2025-09-06T00:35:07.2870857Z TASK [Test Python imports] *****************************************************
2025-09-06T00:35:10.6113427Z changed: [***] => ***"changed": true, "cmd": ["python3", "-c", "import sys; print('Python path:', sys.path); import src.participation_bot"], "delta": "0:00:01.935018", "end": "2025-09-06 00:35:10.422428", "failed_when_result": false, "msg": "", "rc": 0, "start": "2025-09-06 00:35:08.487410", "stderr": "", "stderr_lines": [], "stdout": "Python path: ['', '/app', '/app/$PYTHONPATH', '/usr/lib/python310.zip', '/usr/lib/python3.10', '/usr/lib/python3.10/lib-dynload', '/root/.local/lib/python3.10/site-packages', '/usr/local/lib/python3.10/dist-packages', '/usr/lib/python3/dist-packages']\nWarning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value", "stdout_lines": ["Python path: ['', '/app', '/app/$PYTHONPATH', '/usr/lib/python310.zip', '/usr/lib/python3.10', '/usr/lib/python3.10/lib-dynload', '/root/.local/lib/python3.10/site-packages', '/usr/local/lib/python3.10/dist-packages', '/usr/lib/python3/dist-packages']", "Warning: GITHUB_TOKEN not set or using dummy value", "Warning: WEBHOOK_URL not set or using default value", "Warning: UEX_API_KEY not set or using dummy value"]***
2025-09-06T00:35:10.6120820Z 
2025-09-06T00:35:10.6121362Z TASK [Start bot service] *******************************************************
2025-09-06T00:35:10.6370479Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/start_bot.yml for ***
2025-09-06T00:35:10.6371401Z 
2025-09-06T00:35:10.6371989Z TASK [Test Python imports before starting bot] *********************************
2025-09-06T00:35:12.8490687Z changed: [***] => ***"changed": true, "cmd": ["python3", "-c", "import src.participation_bot; print('Import successful')"], "delta": "0:00:00.734275", "end": "2025-09-06 00:35:12.662576", "msg": "", "rc": 0, "start": "2025-09-06 00:35:11.928301", "stderr": "", "stderr_lines": [], "stdout": "Warning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value\nImport successful", "stdout_lines": ["Warning: GITHUB_TOKEN not set or using dummy value", "Warning: WEBHOOK_URL not set or using default value", "Warning: UEX_API_KEY not set or using dummy value", "Import successful"]***
2025-09-06T00:35:12.8494088Z 
2025-09-06T00:35:12.8494615Z TASK [Show import test result] *************************************************
2025-09-06T00:35:12.8741528Z ok: [***] => ***
2025-09-06T00:35:12.8743225Z     "msg": "Import test result: Warning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value\nImport successful"
2025-09-06T00:35:12.8744937Z ***
2025-09-06T00:35:12.8745295Z 
2025-09-06T00:35:12.8745792Z TASK [Start bot process] *******************************************************
2025-09-06T00:35:14.5907178Z fatal: [***]: FAILED! => ***"changed": true, "cmd": "cd /app\nexport PYTHONPATH=\"/app:$PYTHONPATH\"\nsource .env\necho \"Starting bot with environment:\"\necho \"DISCORD_TOKEN: $***DISCORD_TOKEN:0:10***...\"\necho \"DATABASE_URL: $***DATABASE_URL:0:20***...\"\necho \"TEXT_CHANNEL_ID: $TEXT_CHANNEL_ID\"\necho \"PYTHONPATH: $PYTHONPATH\"\nnohup python3 -m src.participation_bot > /app/bot.log 2>&1 &\nBOT_PID=$!\necho $BOT_PID > /app/bot.pid\necho \"Bot started with PID: $BOT_PID\"\nsleep 1\nif kill -0 $BOT_PID 2>/dev/null; then\n  echo \"Bot process is running\"\nelse\n  echo \"Bot process failed to start or died immediately\"\n  if [ -f /app/bot.log ]; then\n    echo \"Bot log contents:\"\n    cat /app/bot.log\n  fi\nfi\n", "delta": "0:00:00.030477", "end": "2025-09-06 00:35:14.413205", "msg": "non-zero return code", "rc": 2, "start": "2025-09-06 00:35:14.382728", "stderr": "/bin/sh: 3: source: not found\n/bin/sh: 5: Bad substitution", "stderr_lines": ["/bin/sh: 3: source: not found", "/bin/sh: 5: Bad substitution"], "stdout": "Starting bot with environment:", "stdout_lines": ["Starting bot with environment:"]***
2025-09-06T00:35:14.5911756Z 
2025-09-06T00:35:14.5912037Z PLAY RECAP *********************************************************************
2025-09-06T00:35:14.5912783Z ***               : ok=21   changed=8    unreachable=0    failed=1    skipped=5    rescued=0    ignored=0   
2025-09-06T00:35:14.5913221Z 
2025-09-06T00:35:14.6374826Z ##[error]Process completed with exit code 2.
