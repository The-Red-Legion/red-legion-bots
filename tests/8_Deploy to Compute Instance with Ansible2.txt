2025-09-06T00:47:57.3634337Z ##[group]Run echo "=== Starting Ansible deployment ==="
2025-09-06T00:47:57.3635014Z [36;1mecho "=== Starting Ansible deployment ==="[0m
2025-09-06T00:47:57.3635566Z [36;1m[0m
2025-09-06T00:47:57.3636032Z [36;1m# Set environment variables for Ansible[0m
2025-09-06T00:47:57.3636866Z [36;1mexport DISCORD_TOKEN=***[0m
2025-09-06T00:47:57.3637417Z [36;1mexport TEXT_CHANNEL_ID=***[0m
2025-09-06T00:47:57.3638235Z [36;1mexport DATABASE_URL=***[0m
2025-09-06T00:47:57.3639007Z [36;1m[0m
2025-09-06T00:47:57.3639457Z [36;1m# Run Ansible playbook[0m
2025-09-06T00:47:57.3640206Z [36;1mDISCORD_TOKEN=*** \[0m
2025-09-06T00:47:57.3640728Z [36;1mTEXT_CHANNEL_ID=*** \[0m
2025-09-06T00:47:57.3641501Z [36;1mDATABASE_URL=*** \[0m
2025-09-06T00:47:57.3642121Z [36;1mansible-playbook ansible/deploy.yml -i ansible/inventory.ini -v[0m
2025-09-06T00:47:57.3642762Z [36;1m[0m
2025-09-06T00:47:57.3643238Z [36;1mecho "=== Ansible deployment completed ==="[0m
2025-09-06T00:47:57.3643777Z [36;1m[0m
2025-09-06T00:47:57.3644265Z [36;1mecho "=== Waiting for bot to stabilize ==="[0m
2025-09-06T00:47:57.3644794Z [36;1msleep 10[0m
2025-09-06T00:47:57.3645274Z [36;1mecho "=== Bot startup wait completed ==="[0m
2025-09-06T00:47:57.3674601Z shell: /usr/bin/bash --noprofile --norc -e -o pipefail ***0***
2025-09-06T00:47:57.3675221Z env:
2025-09-06T00:47:57.3675923Z   DATABASE_URL: ***
2025-09-06T00:47:57.3676451Z   pythonLocation: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T00:47:57.3677148Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.9.23/x64/lib/pkgconfig
2025-09-06T00:47:57.3677829Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T00:47:57.3678470Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T00:47:57.3679296Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T00:47:57.3679914Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.9.23/x64/lib
2025-09-06T00:47:57.3680821Z   CLOUDSDK_AUTH_CREDENTIAL_FILE_OVERRIDE: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-a3ded6cd087efc3e.json
2025-09-06T00:47:57.3681927Z   GOOGLE_APPLICATION_CREDENTIALS: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-a3ded6cd087efc3e.json
2025-09-06T00:47:57.3682935Z   GOOGLE_GHA_CREDS_PATH: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-a3ded6cd087efc3e.json
2025-09-06T00:47:57.3683685Z   CLOUDSDK_CORE_PROJECT: rl-prod-471116
2025-09-06T00:47:57.3684234Z   CLOUDSDK_PROJECT: rl-prod-471116
2025-09-06T00:47:57.3684760Z   GCLOUD_PROJECT: rl-prod-471116
2025-09-06T00:47:57.3685250Z   GCP_PROJECT: rl-prod-471116
2025-09-06T00:47:57.3685736Z   GOOGLE_CLOUD_PROJECT: rl-prod-471116
2025-09-06T00:47:57.3686416Z ##[endgroup]
2025-09-06T00:47:57.3737859Z === Starting Ansible deployment ===
2025-09-06T00:47:58.0595281Z [WARNING]: Invalid characters were found in group names but not replaced, use
2025-09-06T00:47:58.0596361Z -vvvv to see details
2025-09-06T00:47:58.2865772Z Using /home/runner/work/red-legion-bots/red-legion-bots/ansible.cfg as config file
2025-09-06T00:47:58.2866541Z 
2025-09-06T00:47:58.2866954Z PLAY [Deploy Participation Bot] ************************************************
2025-09-06T00:47:58.2867490Z 
2025-09-06T00:47:58.2867839Z TASK [Gathering Facts] *********************************************************
2025-09-06T00:48:01.9389426Z ok: [***]
2025-09-06T00:48:01.9389834Z 
2025-09-06T00:48:01.9390323Z TASK [Update system packages] **************************************************
2025-09-06T00:48:15.3217284Z ok: [***] => ***"changed": false, "msg": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n", "stderr": "", "stderr_lines": [], "stdout": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n", "stdout_lines": ["Reading package lists...", "Building dependency tree...", "Reading state information...", "Calculating upgrade...", "0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded."]***
2025-09-06T00:48:15.3221942Z 
2025-09-06T00:48:15.3222529Z TASK [Install required system packages] ****************************************
2025-09-06T00:48:18.4386055Z ok: [***] => ***"cache_update_time": 1757119685, "cache_updated": false, "changed": false***
2025-09-06T00:48:18.4386905Z 
2025-09-06T00:48:18.4387469Z TASK [Install pip via package manager] *****************************************
2025-09-06T00:48:25.2885653Z ok: [***] => ***"cache_update_time": 1757119702, "cache_updated": true, "changed": false***
2025-09-06T00:48:25.2886280Z 
2025-09-06T00:48:25.2886641Z TASK [Ensure pip3 is in PATH] **************************************************
2025-09-06T00:48:28.3338381Z changed: [***] => ***"changed": true, "cmd": ["pip3", "--version"], "delta": "0:00:01.238190", "end": "2025-09-06 00:48:28.143354", "msg": "", "rc": 0, "start": "2025-09-06 00:48:26.905164", "stderr": "", "stderr_lines": [], "stdout": "pip 22.0.2 from /usr/lib/python3/dist-packages/pip (python 3.10)", "stdout_lines": ["pip 22.0.2 from /usr/lib/python3/dist-packages/pip (python 3.10)"]***
2025-09-06T00:48:28.3340673Z 
2025-09-06T00:48:28.3341248Z TASK [Check if Google Cloud SDK is available] **********************************
2025-09-06T00:48:29.8463299Z changed: [***] => ***"changed": true, "cmd": ["which", "gcloud"], "delta": "0:00:00.023519", "end": "2025-09-06 00:48:29.666124", "msg": "", "rc": 0, "start": "2025-09-06 00:48:29.642605", "stderr": "", "stderr_lines": [], "stdout": "/snap/bin/gcloud", "stdout_lines": ["/snap/bin/gcloud"]***
2025-09-06T00:48:29.8464300Z 
2025-09-06T00:48:29.8464710Z TASK [Install Google Cloud SDK] ************************************************
2025-09-06T00:48:29.8621703Z skipping: [***] => ***"changed": false, "false_condition": "gcloud_check.rc != 0", "skip_reason": "Conditional result was False"***
2025-09-06T00:48:29.8622360Z 
2025-09-06T00:48:29.8622713Z TASK [Stop existing bot process] ***********************************************
2025-09-06T00:48:29.8839139Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/stop_bot.yml for ***
2025-09-06T00:48:29.8839915Z 
2025-09-06T00:48:29.8840346Z TASK [Check if bot PID file exists] ********************************************
2025-09-06T00:48:31.5850986Z ok: [***] => ***"changed": false, "stat": ***"exists": false***
2025-09-06T00:48:31.5851445Z 
2025-09-06T00:48:31.5851769Z TASK [Read PID from file] ******************************************************
2025-09-06T00:48:31.6058064Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T00:48:31.6059373Z 
2025-09-06T00:48:31.6059724Z TASK [Stop existing bot process] ***********************************************
2025-09-06T00:48:31.6272120Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T00:48:31.6273060Z 
2025-09-06T00:48:31.6273406Z TASK [Wait for process to terminate] *******************************************
2025-09-06T00:48:31.6476651Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T00:48:31.6477513Z 
2025-09-06T00:48:31.6477857Z TASK [Force kill if still running] *********************************************
2025-09-06T00:48:31.6681078Z skipping: [***] => ***"changed": false, "false_condition": "pid_file is defined and pid_file.stat is defined and pid_file.stat.exists and not ansible_check_mode", "skip_reason": "Conditional result was False"***
2025-09-06T00:48:31.6681971Z 
2025-09-06T00:48:31.6682289Z TASK [Remove PID file] *********************************************************
2025-09-06T00:48:33.1939498Z ok: [***] => ***"changed": false, "path": "/app/bot.pid", "state": "absent"***
2025-09-06T00:48:33.1940063Z 
2025-09-06T00:48:33.1940442Z TASK [Clean and prepare application directory] *********************************
2025-09-06T00:48:34.9040322Z changed: [***] => ***"changed": true, "path": "/app", "state": "absent"***
2025-09-06T00:48:34.9041379Z 
2025-09-06T00:48:34.9042174Z TASK [Create application directory] ********************************************
2025-09-06T00:48:36.3046878Z changed: [***] => ***"changed": true, "gid": 1000, "group": "ubuntu", "mode": "0755", "owner": "ubuntu", "path": "/app", "size": 4096, "state": "directory", "uid": 1000***
2025-09-06T00:48:36.3047935Z 
2025-09-06T00:48:36.3048429Z TASK [Copy application code] ***************************************************
2025-09-06T00:55:32.5641433Z changed: [***] => ***"changed": true, "dest": "/app/", "src": "/home/runner/work/red-legion-bots/red-legion-bots/"***
2025-09-06T00:55:32.5642407Z 
2025-09-06T00:55:32.5643649Z TASK [Install Python dependencies] *********************************************
2025-09-06T00:55:37.5326559Z ok: [***] => ***"changed": false, "cmd": ["/usr/bin/pip3", "install", "--user", "-r", "/app/requirements.txt"], "name": null, "requirements": "/app/requirements.txt", "state": "present", "stderr": "WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\n", "stderr_lines": ["WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv"], "stdout": "Requirement already satisfied: discord.py==2.4.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 1)) (2.4.0)\nRequirement already satisfied: psycopg2-binary==2.9.9 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 2)) (2.9.9)\nRequirement already satisfied: python-dotenv==1.0.1 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 3)) (1.0.1)\nRequirement already satisfied: google-cloud-secret-manager==2.20.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 4)) (2.20.0)\nRequirement already satisfied: aiohttp==3.9.5 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 5)) (3.9.5)\nRequirement already satisfied: proto-plus<2.0.0dev,>=1.22.3 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.26.1)\nRequirement already satisfied: grpc-google-iam-v1<1.0.0dev,>=0.12.4 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.14.2)\nRequirement already satisfied: google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)\nRequirement already satisfied: google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.40.3)\nRequirement already satisfied: protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.25.8)\nRequirement already satisfied: frozenlist>=1.1.1 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.7.0)\nRequirement already satisfied: async-timeout<5.0,>=4.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.0.3)\nRequirement already satisfied: multidict<7.0,>=4.5 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (6.6.4)\nRequirement already satisfied: attrs>=17.3.0 in /usr/lib/python3/dist-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (21.2.0)\nRequirement already satisfied: aiosignal>=1.1.2 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.4.0)\nRequirement already satisfied: yarl<2.0,>=1.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.20.1)\nRequirement already satisfied: typing-extensions>=4.2 in /root/.local/lib/python3.10/site-packages (from aiosignal>=1.1.2->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.15.0)\nRequirement already satisfied: requests<3.0.0,>=2.18.0 in /usr/lib/python3/dist-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)\nRequirement already satisfied: googleapis-common-protos<2.0.0,>=1.56.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.70.0)\nRequirement already satisfied: grpcio-status<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.62.3)\nRequirement already satisfied: grpcio<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.74.0)\nRequirement already satisfied: cachetools<6.0,>=2.0.0 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (5.5.2)\nRequirement already satisfied: rsa<5,>=3.1.4 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.9.1)\nRequirement already satisfied: pyasn1-modules>=0.2.1 in /usr/lib/python3/dist-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.2.1)\nRequirement already satisfied: idna>=2.0 in /usr/lib/python3/dist-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (3.3)\nRequirement already satisfied: propcache>=0.2.1 in /root/.local/lib/python3.10/site-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (0.3.2)\nRequirement already satisfied: pyasn1>=0.1.3 in /usr/lib/python3/dist-packages (from rsa<5,>=3.1.4->google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.4.8)\n", "stdout_lines": ["Requirement already satisfied: discord.py==2.4.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 1)) (2.4.0)", "Requirement already satisfied: psycopg2-binary==2.9.9 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 2)) (2.9.9)", "Requirement already satisfied: python-dotenv==1.0.1 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 3)) (1.0.1)", "Requirement already satisfied: google-cloud-secret-manager==2.20.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 4)) (2.20.0)", "Requirement already satisfied: aiohttp==3.9.5 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 5)) (3.9.5)", "Requirement already satisfied: proto-plus<2.0.0dev,>=1.22.3 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.26.1)", "Requirement already satisfied: grpc-google-iam-v1<1.0.0dev,>=0.12.4 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.14.2)", "Requirement already satisfied: google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)", "Requirement already satisfied: google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.40.3)", "Requirement already satisfied: protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.25.8)", "Requirement already satisfied: frozenlist>=1.1.1 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.7.0)", "Requirement already satisfied: async-timeout<5.0,>=4.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.0.3)", "Requirement already satisfied: multidict<7.0,>=4.5 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (6.6.4)", "Requirement already satisfied: attrs>=17.3.0 in /usr/lib/python3/dist-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (21.2.0)", "Requirement already satisfied: aiosignal>=1.1.2 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.4.0)", "Requirement already satisfied: yarl<2.0,>=1.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.20.1)", "Requirement already satisfied: typing-extensions>=4.2 in /root/.local/lib/python3.10/site-packages (from aiosignal>=1.1.2->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.15.0)", "Requirement already satisfied: requests<3.0.0,>=2.18.0 in /usr/lib/python3/dist-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)", "Requirement already satisfied: googleapis-common-protos<2.0.0,>=1.56.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.70.0)", "Requirement already satisfied: grpcio-status<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.62.3)", "Requirement already satisfied: grpcio<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.74.0)", "Requirement already satisfied: cachetools<6.0,>=2.0.0 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (5.5.2)", "Requirement already satisfied: rsa<5,>=3.1.4 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.9.1)", "Requirement already satisfied: pyasn1-modules>=0.2.1 in /usr/lib/python3/dist-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.2.1)", "Requirement already satisfied: idna>=2.0 in /usr/lib/python3/dist-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (3.3)", "Requirement already satisfied: propcache>=0.2.1 in /root/.local/lib/python3.10/site-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (0.3.2)", "Requirement already satisfied: pyasn1>=0.1.3 in /usr/lib/python3/dist-packages (from rsa<5,>=3.1.4->google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.4.8)"], "version": null, "virtualenv": null***
2025-09-06T00:55:37.5368119Z 
2025-09-06T00:55:37.5368484Z TASK [Install additional packages] *********************************************
2025-09-06T00:55:40.1425854Z ok: [***] => ***"changed": false, "cmd": ["/usr/bin/pip3", "install", "--user", "psycopg2-binary"], "name": ["psycopg2-binary"], "requirements": null, "state": "present", "stderr": "WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\n", "stderr_lines": ["WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv"], "stdout": "Requirement already satisfied: psycopg2-binary in /root/.local/lib/python3.10/site-packages (2.9.9)\n", "stdout_lines": ["Requirement already satisfied: psycopg2-binary in /root/.local/lib/python3.10/site-packages (2.9.9)"], "version": null, "virtualenv": null***
2025-09-06T00:55:40.1429987Z 
2025-09-06T00:55:40.1430393Z TASK [Set up environment variables] ********************************************
2025-09-06T00:55:40.1652737Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/setup_environment.yml for ***
2025-09-06T00:55:40.1653496Z 
2025-09-06T00:55:40.1653895Z TASK [Create .env file] ********************************************************
2025-09-06T00:55:43.2941799Z changed: [***] => ***"changed": true, "checksum": "a974a4f3ee2ec4647427d36713d12cb9940147b7", "dest": "/app/.env", "gid": 1000, "group": "ubuntu", "md5sum": "87eb36bf35058f17fde58db0ef954cb3", "mode": "0600", "owner": "ubuntu", "size": 252, "src": "/home/ubuntu/.ansible/tmp/ansible-tmp-1757120140.288176-3587-40335011521267/source", "state": "file", "uid": 1000***
2025-09-06T00:55:43.2944501Z 
2025-09-06T00:55:43.2944899Z TASK [Set PYTHONPATH environment variable] *************************************
2025-09-06T00:55:44.7507102Z ok: [***] => ***"backup": "", "changed": false, "msg": ""***
2025-09-06T00:55:44.7507787Z 
2025-09-06T00:55:44.7508316Z TASK [Test Python imports] *****************************************************
2025-09-06T00:55:48.0682700Z changed: [***] => ***"changed": true, "cmd": ["python3", "-c", "import sys; print('Python path:', sys.path); import src.participation_bot"], "delta": "0:00:01.946455", "end": "2025-09-06 00:55:47.884846", "failed_when_result": false, "msg": "", "rc": 0, "start": "2025-09-06 00:55:45.938391", "stderr": "", "stderr_lines": [], "stdout": "Python path: ['', '/app', '/app/$PYTHONPATH', '/usr/lib/python310.zip', '/usr/lib/python3.10', '/usr/lib/python3.10/lib-dynload', '/root/.local/lib/python3.10/site-packages', '/usr/local/lib/python3.10/dist-packages', '/usr/lib/python3/dist-packages']\nWarning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value", "stdout_lines": ["Python path: ['', '/app', '/app/$PYTHONPATH', '/usr/lib/python310.zip', '/usr/lib/python3.10', '/usr/lib/python3.10/lib-dynload', '/root/.local/lib/python3.10/site-packages', '/usr/local/lib/python3.10/dist-packages', '/usr/lib/python3/dist-packages']", "Warning: GITHUB_TOKEN not set or using dummy value", "Warning: WEBHOOK_URL not set or using default value", "Warning: UEX_API_KEY not set or using dummy value"]***
2025-09-06T00:55:48.0687294Z 
2025-09-06T00:55:48.0687617Z TASK [Start bot service] *******************************************************
2025-09-06T00:55:48.0941506Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/start_bot.yml for ***
2025-09-06T00:55:48.0942196Z 
2025-09-06T00:55:48.0942639Z TASK [Test Python imports before starting bot] *********************************
2025-09-06T00:55:50.1418778Z changed: [***] => ***"changed": true, "cmd": ["python3", "-c", "import src.participation_bot; print('Import successful')"], "delta": "0:00:00.603274", "end": "2025-09-06 00:55:49.963189", "msg": "", "rc": 0, "start": "2025-09-06 00:55:49.359915", "stderr": "", "stderr_lines": [], "stdout": "Warning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value\nImport successful", "stdout_lines": ["Warning: GITHUB_TOKEN not set or using dummy value", "Warning: WEBHOOK_URL not set or using default value", "Warning: UEX_API_KEY not set or using dummy value", "Import successful"]***
2025-09-06T00:55:50.1421500Z 
2025-09-06T00:55:50.1421913Z TASK [Show import test result] *************************************************
2025-09-06T00:55:50.1660068Z ok: [***] => ***
2025-09-06T00:55:50.1661240Z     "msg": "Import test result: Warning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value\nImport successful"
2025-09-06T00:55:50.1662421Z ***
2025-09-06T00:55:50.1662666Z 
2025-09-06T00:55:50.1663015Z TASK [Start bot process] *******************************************************
2025-09-06T00:55:53.6343959Z changed: [***] => ***"changed": true, "cmd": "#!/bin/bash\ncd /app\nexport PYTHONPATH=\"/app:$PYTHONPATH\"\n\n# Load environment variables from .env file\nif [ -f .env ]; then\n  set -a  # automatically export all variables\n  . .env  # use . instead of source for compatibility\n  set +a\nfi\n\necho \"Starting bot with environment:\"\necho \"DISCORD_TOKEN: $***DISCORD_TOKEN:0:10***...\"\necho \"DATABASE_URL: $***DATABASE_URL:0:20***...\"\necho \"TEXT_CHANNEL_ID: $TEXT_CHANNEL_ID\"\necho \"PYTHONPATH: $PYTHONPATH\"\n\nnohup python3 -m src.participation_bot > /app/bot.log 2>&1 &\nBOT_PID=$!\necho $BOT_PID > /app/bot.pid\necho \"Bot started with PID: $BOT_PID\"\nsleep 2\n\nif kill -0 $BOT_PID 2>/dev/null; then\n  echo \"Bot process is running\"\nelse\n  echo \"Bot process failed to start or died immediately\"\n  if [ -f /app/bot.log ]; then\n    echo \"Bot log contents:\"\n    cat /app/bot.log\n  fi\nfi\n", "delta": "0:00:02.010700", "end": "2025-09-06 00:55:53.449965", "msg": "", "rc": 0, "start": "2025-09-06 00:55:51.439265", "stderr": "", "stderr_lines": [], "stdout": "Starting bot with environment:\nDISCORD_TOKEN: MTQxMTc4ND...\nDATABASE_URL: postgresql://event_u...\nTEXT_CHANNEL_ID: ***\nPYTHONPATH: /app:/app:$PYTHONPATH\nBot started with PID: 43832\nBot process is running", "stdout_lines": ["Starting bot with environment:", "DISCORD_TOKEN: MTQxMTc4ND...", "DATABASE_URL: postgresql://event_u...", "TEXT_CHANNEL_ID: ***", "PYTHONPATH: /app:/app:$PYTHONPATH", "Bot started with PID: 43832", "Bot process is running"]***
2025-09-06T00:55:53.6353103Z 
2025-09-06T00:55:53.6353693Z TASK [Show startup debug info] *************************************************
2025-09-06T00:55:53.6579573Z ok: [***] => ***
2025-09-06T00:55:53.6580354Z     "msg": [
2025-09-06T00:55:53.6581147Z         "Starting bot with environment:",
2025-09-06T00:55:53.6582063Z         "DISCORD_TOKEN: MTQxMTc4ND...",
2025-09-06T00:55:53.6583008Z         "DATABASE_URL: postgresql://event_u...",
2025-09-06T00:55:53.6583982Z         "TEXT_CHANNEL_ID: ***",
2025-09-06T00:55:53.6584830Z         "PYTHONPATH: /app:/app:$PYTHONPATH",
2025-09-06T00:55:53.6585739Z         "Bot started with PID: 43832",
2025-09-06T00:55:53.6586905Z         "Bot process is running"
2025-09-06T00:55:53.6587699Z     ]
2025-09-06T00:55:53.6588379Z ***
2025-09-06T00:55:53.6588920Z 
2025-09-06T00:55:53.6589446Z TASK [Wait for bot to start] ***************************************************
2025-09-06T00:55:56.6813589Z Pausing for 3 seconds
2025-09-06T00:55:56.6814773Z ok: [***] => ***"changed": false, "delta": 3, "echo": true, "rc": 0, "start": "2025-09-06 00:55:53.668657", "stderr": "", "stdout": "Paused for 3.0 seconds", "stop": "2025-09-06 00:55:56.672934", "user_input": ""***
2025-09-06T00:55:56.6815571Z 
2025-09-06T00:55:56.6815964Z TASK [Verify bot process is running] *******************************************
2025-09-06T00:55:58.1814636Z changed: [***] => ***"changed": true, "cmd": "#!/bin/bash\nif [ -f \"/app/bot.pid\" ]; then\n  kill -0 $(cat /app/bot.pid) 2>/dev/null\nelse\n  exit 1\nfi\n", "delta": "0:00:00.019090", "end": "2025-09-06 00:55:57.993340", "failed_when_result": false, "msg": "", "rc": 0, "start": "2025-09-06 00:55:57.974250", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []***
2025-09-06T00:55:58.1815925Z 
2025-09-06T00:55:58.1816275Z TASK [Show bot log if startup failed] ******************************************
2025-09-06T00:55:58.2124798Z skipping: [***] => ***"changed": false, "false_condition": "(bot_check is defined and (bot_check.rc | default(0)) != 0 and not ansible_check_mode) or (ansible_check_mode and false)", "skip_reason": "Conditional result was False"***
2025-09-06T00:55:58.2125730Z 
2025-09-06T00:55:58.2126042Z TASK [Fail with bot log] *******************************************************
2025-09-06T00:55:58.2432490Z skipping: [***] => ***"changed": false, "false_condition": "(bot_check is defined and (bot_check.rc | default(0)) != 0 and not ansible_check_mode) or (ansible_check_mode and false)", "skip_reason": "Conditional result was False"***
2025-09-06T00:55:58.2433399Z 
2025-09-06T00:55:58.2433731Z TASK [Verify bot is running] ***************************************************
2025-09-06T00:55:58.2702828Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/verify_bot.yml for ***
2025-09-06T00:55:58.2703634Z 
2025-09-06T00:55:58.2704098Z TASK [Check if bot PID file exists] ********************************************
2025-09-06T00:55:59.7302687Z ok: [***] => ***"changed": false, "stat": ***"atime": 1757120157.9916995, "attr_flags": "e", "attributes": ["extents"], "block_size": 4096, "blocks": 8, "charset": "us-ascii", "checksum": "b6230f61170d8a216fd97f902167147e0e9d3219", "ctime": 1757120151.4451652, "dev": 2049, "device_type": 0, "executable": false, "exists": true, "gid": 0, "gr_name": "root", "inode": 774212, "isblk": false, "ischr": false, "isdir": false, "isfifo": false, "isgid": false, "islnk": false, "isreg": true, "issock": false, "isuid": false, "mimetype": "text/plain", "mode": "0644", "mtime": 1757120151.4451652, "nlink": 1, "path": "/app/bot.pid", "pw_name": "root", "readable": true, "rgrp": true, "roth": true, "rusr": true, "size": 6, "uid": 0, "version": "1819842462", "wgrp": false, "woth": false, "writeable": true, "wusr": true, "xgrp": false, "xoth": false, "xusr": false***
2025-09-06T00:55:59.7307293Z 
2025-09-06T00:55:59.7307853Z TASK [Verify bot process is running] *******************************************
2025-09-06T00:56:01.1033729Z fatal: [***]: FAILED! => ***"changed": true, "cmd": ["kill", "-0", "$(cat", "/app/bot.pid)"], "delta": "0:00:00.010138", "end": "2025-09-06 00:56:00.929830", "failed_when_result": true, "msg": "non-zero return code", "rc": 1, "start": "2025-09-06 00:56:00.919692", "stderr": "kill: failed to parse argument: '$(cat'", "stderr_lines": ["kill: failed to parse argument: '$(cat'"], "stdout": "", "stdout_lines": []***
2025-09-06T00:56:01.1036505Z 
2025-09-06T00:56:01.1037136Z PLAY RECAP *********************************************************************
2025-09-06T00:56:01.1038422Z ***               : ok=27   changed=10   unreachable=0    failed=1    skipped=7    rescued=0    ignored=0   
2025-09-06T00:56:01.1039724Z 
2025-09-06T00:56:01.1506189Z ##[error]Process completed with exit code 2.
