2025-09-06T01:39:17.9793785Z ##[group]Run echo "=== Starting Ansible deployment ==="
2025-09-06T01:39:17.9794474Z [36;1mecho "=== Starting Ansible deployment ==="[0m
2025-09-06T01:39:17.9795027Z [36;1m[0m
2025-09-06T01:39:17.9795488Z [36;1m# Set environment variables for Ansible[0m
2025-09-06T01:39:17.9796307Z [36;1mexport DISCORD_TOKEN=***[0m
2025-09-06T01:39:17.9797068Z [36;1mexport TEXT_CHANNEL_ID=***[0m
2025-09-06T01:39:17.9797927Z [36;1mexport DATABASE_URL=***[0m
2025-09-06T01:39:17.9798426Z [36;1m[0m
2025-09-06T01:39:17.9798878Z [36;1m# Run Ansible playbook[0m
2025-09-06T01:39:17.9799617Z [36;1mDISCORD_TOKEN=*** \[0m
2025-09-06T01:39:17.9800154Z [36;1mTEXT_CHANNEL_ID=*** \[0m
2025-09-06T01:39:17.9800920Z [36;1mDATABASE_URL=*** \[0m
2025-09-06T01:39:17.9801542Z [36;1mansible-playbook ansible/deploy.yml -i ansible/inventory.ini -v[0m
2025-09-06T01:39:17.9802168Z [36;1m[0m
2025-09-06T01:39:17.9802636Z [36;1mecho "=== Ansible deployment completed ==="[0m
2025-09-06T01:39:17.9803171Z [36;1m[0m
2025-09-06T01:39:17.9803683Z [36;1mecho "=== Waiting for bot to stabilize ==="[0m
2025-09-06T01:39:17.9804228Z [36;1msleep 10[0m
2025-09-06T01:39:17.9804725Z [36;1mecho "=== Bot startup wait completed ==="[0m
2025-09-06T01:39:17.9835229Z shell: /usr/bin/bash --noprofile --norc -e -o pipefail ***0***
2025-09-06T01:39:17.9835854Z env:
2025-09-06T01:39:17.9836546Z   DATABASE_URL: ***
2025-09-06T01:39:17.9837276Z   pythonLocation: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T01:39:17.9837968Z   PKG_CONFIG_PATH: /opt/hostedtoolcache/Python/3.9.23/x64/lib/pkgconfig
2025-09-06T01:39:17.9838652Z   Python_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T01:39:17.9839283Z   Python2_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T01:39:17.9839910Z   Python3_ROOT_DIR: /opt/hostedtoolcache/Python/3.9.23/x64
2025-09-06T01:39:17.9840525Z   LD_LIBRARY_PATH: /opt/hostedtoolcache/Python/3.9.23/x64/lib
2025-09-06T01:39:17.9841407Z   CLOUDSDK_AUTH_CREDENTIAL_FILE_OVERRIDE: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-5bf8b4b754cf3ac7.json
2025-09-06T01:39:17.9842497Z   GOOGLE_APPLICATION_CREDENTIALS: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-5bf8b4b754cf3ac7.json
2025-09-06T01:39:17.9843501Z   GOOGLE_GHA_CREDS_PATH: /home/runner/work/red-legion-bots/red-legion-bots/gha-creds-5bf8b4b754cf3ac7.json
2025-09-06T01:39:17.9844268Z   CLOUDSDK_CORE_PROJECT: rl-prod-471116
2025-09-06T01:39:17.9844809Z   CLOUDSDK_PROJECT: rl-prod-471116
2025-09-06T01:39:17.9845322Z   GCLOUD_PROJECT: rl-prod-471116
2025-09-06T01:39:17.9845814Z   GCP_PROJECT: rl-prod-471116
2025-09-06T01:39:17.9846312Z   GOOGLE_CLOUD_PROJECT: rl-prod-471116
2025-09-06T01:39:17.9847187Z ##[endgroup]
2025-09-06T01:39:18.0370833Z === Starting Ansible deployment ===
2025-09-06T01:39:18.7412373Z [WARNING]: Invalid characters were found in group names but not replaced, use
2025-09-06T01:39:18.7413091Z -vvvv to see details
2025-09-06T01:39:19.0396604Z Using /home/runner/work/red-legion-bots/red-legion-bots/ansible.cfg as config file
2025-09-06T01:39:19.0398906Z 
2025-09-06T01:39:19.0399762Z PLAY [Deploy Participation Bot] ************************************************
2025-09-06T01:39:19.0400593Z 
2025-09-06T01:39:19.0401160Z TASK [Gathering Facts] *********************************************************
2025-09-06T01:39:21.8292850Z ok: [***]
2025-09-06T01:39:21.8293311Z 
2025-09-06T01:39:21.8293871Z TASK [Update system packages] **************************************************
2025-09-06T01:39:29.1183373Z ok: [***] => ***"changed": false, "msg": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n", "stderr": "", "stderr_lines": [], "stdout": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\n", "stdout_lines": ["Reading package lists...", "Building dependency tree...", "Reading state information...", "Calculating upgrade...", "0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded."]***
2025-09-06T01:39:29.1186296Z 
2025-09-06T01:39:29.1186652Z TASK [Install required system packages] ****************************************
2025-09-06T01:39:31.5924042Z ok: [***] => ***"cache_update_time": 1757122766, "cache_updated": false, "changed": false***
2025-09-06T01:39:31.5924665Z 
2025-09-06T01:39:31.5925012Z TASK [Install pip via package manager] *****************************************
2025-09-06T01:39:36.5703741Z ok: [***] => ***"cache_update_time": 1757122774, "cache_updated": true, "changed": false***
2025-09-06T01:39:36.5704362Z 
2025-09-06T01:39:36.5704716Z TASK [Ensure pip3 is in PATH] **************************************************
2025-09-06T01:39:38.5539295Z changed: [***] => ***"changed": true, "cmd": ["pip3", "--version"], "delta": "0:00:01.241143", "end": "2025-09-06 01:39:38.465203", "msg": "", "rc": 0, "start": "2025-09-06 01:39:37.224060", "stderr": "", "stderr_lines": [], "stdout": "pip 22.0.2 from /usr/lib/python3/dist-packages/pip (python 3.10)", "stdout_lines": ["pip 22.0.2 from /usr/lib/python3/dist-packages/pip (python 3.10)"]***
2025-09-06T01:39:38.5540595Z 
2025-09-06T01:39:38.5540944Z TASK [Check if Google Cloud SDK is available] **********************************
2025-09-06T01:39:39.2152797Z changed: [***] => ***"changed": true, "cmd": ["which", "gcloud"], "delta": "0:00:00.028334", "end": "2025-09-06 01:39:39.123157", "msg": "", "rc": 0, "start": "2025-09-06 01:39:39.094823", "stderr": "", "stderr_lines": [], "stdout": "/snap/bin/gcloud", "stdout_lines": ["/snap/bin/gcloud"]***
2025-09-06T01:39:39.2153802Z 
2025-09-06T01:39:39.2154147Z TASK [Install Google Cloud SDK] ************************************************
2025-09-06T01:39:39.2309703Z skipping: [***] => ***"changed": false, "false_condition": "gcloud_check.rc != 0", "skip_reason": "Conditional result was False"***
2025-09-06T01:39:39.2310350Z 
2025-09-06T01:39:39.2310687Z TASK [Stop existing bot process] ***********************************************
2025-09-06T01:39:39.2526691Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/stop_bot.yml for ***
2025-09-06T01:39:39.2527465Z 
2025-09-06T01:39:39.2527830Z TASK [Check if bot PID file exists] ********************************************
2025-09-06T01:39:40.0206136Z ok: [***] => ***"changed": false, "stat": ***"atime": 1757121102.1787398, "attr_flags": "e", "attributes": ["extents"], "block_size": 4096, "blocks": 8, "charset": "us-ascii", "checksum": "ad83e83278cbe51685138b483d2b1e681da89d51", "ctime": 1757121095.3351812, "dev": 2049, "device_type": 0, "executable": false, "exists": true, "gid": 0, "gr_name": "root", "inode": 774214, "isblk": false, "ischr": false, "isdir": false, "isfifo": false, "isgid": false, "islnk": false, "isreg": true, "issock": false, "isuid": false, "mimetype": "text/plain", "mode": "0644", "mtime": 1757121095.3351812, "nlink": 1, "path": "/app/bot.pid", "pw_name": "root", "readable": true, "rgrp": true, "roth": true, "rusr": true, "size": 6, "uid": 0, "version": "2616755310", "wgrp": false, "woth": false, "writeable": true, "wusr": true, "xgrp": false, "xoth": false, "xusr": false***
2025-09-06T01:39:40.0210879Z 
2025-09-06T01:39:40.0211386Z TASK [Read PID from file] ******************************************************
2025-09-06T01:39:40.7360165Z ok: [***] => ***"changed": false, "content": "NTAyODkK", "encoding": "base64", "source": "/app/bot.pid"***
2025-09-06T01:39:40.7361027Z 
2025-09-06T01:39:40.7361531Z TASK [Stop existing bot process] ***********************************************
2025-09-06T01:39:41.3962303Z fatal: [***]: FAILED! => ***"changed": true, "cmd": ["kill", "50289"], "delta": "0:00:00.011729", "end": "2025-09-06 01:39:41.304001", "msg": "non-zero return code", "rc": 1, "start": "2025-09-06 01:39:41.292272", "stderr": "kill: (50289): No such process", "stderr_lines": ["kill: (50289): No such process"], "stdout": "", "stdout_lines": []***
2025-09-06T01:39:41.3964248Z ...ignoring
2025-09-06T01:39:41.3964837Z 
2025-09-06T01:39:41.3965242Z TASK [Wait for process to terminate] *******************************************
2025-09-06T01:39:46.4272947Z Pausing for 5 seconds
2025-09-06T01:39:46.4274124Z ok: [***] => ***"changed": false, "delta": 5, "echo": true, "rc": 0, "start": "2025-09-06 01:39:41.411870", "stderr": "", "stdout": "Paused for 5.01 seconds", "stop": "2025-09-06 01:39:46.418324", "user_input": ""***
2025-09-06T01:39:46.4274929Z 
2025-09-06T01:39:46.4275284Z TASK [Force kill if still running] *********************************************
2025-09-06T01:39:47.0910779Z fatal: [***]: FAILED! => ***"changed": true, "cmd": ["kill", "-9", "50289"], "delta": "0:00:00.008444", "end": "2025-09-06 01:39:46.998801", "msg": "non-zero return code", "rc": 1, "start": "2025-09-06 01:39:46.990357", "stderr": "kill: (50289): No such process", "stderr_lines": ["kill: (50289): No such process"], "stdout": "", "stdout_lines": []***
2025-09-06T01:39:47.0912976Z ...ignoring
2025-09-06T01:39:47.0913358Z 
2025-09-06T01:39:47.0913864Z TASK [Remove PID file] *********************************************************
2025-09-06T01:39:47.8673002Z changed: [***] => ***"changed": true, "path": "/app/bot.pid", "state": "absent"***
2025-09-06T01:39:47.8673542Z 
2025-09-06T01:39:47.8673902Z TASK [Clean and prepare application directory] *********************************
2025-09-06T01:39:48.6129854Z changed: [***] => ***"changed": true, "path": "/app", "state": "absent"***
2025-09-06T01:39:48.6130401Z 
2025-09-06T01:39:48.6130784Z TASK [Create application directory] ********************************************
2025-09-06T01:39:49.5000074Z changed: [***] => ***"changed": true, "gid": 1000, "group": "ubuntu", "mode": "0755", "owner": "ubuntu", "path": "/app", "size": 4096, "state": "directory", "uid": 1000***
2025-09-06T01:39:49.5000765Z 
2025-09-06T01:39:49.5001100Z TASK [Copy application code] ***************************************************
2025-09-06T01:48:25.4960065Z changed: [***] => ***"changed": true, "dest": "/app/", "src": "/home/runner/work/red-legion-bots/red-legion-bots/"***
2025-09-06T01:48:25.4961024Z 
2025-09-06T01:48:25.4961941Z TASK [Install Python dependencies] *********************************************
2025-09-06T01:48:55.4827770Z ok: [***] => ***"changed": false, "cmd": ["/usr/bin/pip3", "install", "--user", "-r", "/app/requirements.txt"], "name": null, "requirements": "/app/requirements.txt", "state": "present", "stderr": "WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\n", "stderr_lines": ["WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv"], "stdout": "Requirement already satisfied: discord.py==2.4.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 1)) (2.4.0)\nRequirement already satisfied: psycopg2-binary==2.9.9 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 2)) (2.9.9)\nRequirement already satisfied: python-dotenv==1.0.1 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 3)) (1.0.1)\nRequirement already satisfied: google-cloud-secret-manager==2.20.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 4)) (2.20.0)\nRequirement already satisfied: aiohttp==3.9.5 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 5)) (3.9.5)\nRequirement already satisfied: google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.40.3)\nRequirement already satisfied: protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.25.8)\nRequirement already satisfied: grpc-google-iam-v1<1.0.0dev,>=0.12.4 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.14.2)\nRequirement already satisfied: google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)\nRequirement already satisfied: proto-plus<2.0.0dev,>=1.22.3 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.26.1)\nRequirement already satisfied: attrs>=17.3.0 in /usr/lib/python3/dist-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (21.2.0)\nRequirement already satisfied: yarl<2.0,>=1.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.20.1)\nRequirement already satisfied: frozenlist>=1.1.1 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.7.0)\nRequirement already satisfied: multidict<7.0,>=4.5 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (6.6.4)\nRequirement already satisfied: async-timeout<5.0,>=4.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.0.3)\nRequirement already satisfied: aiosignal>=1.1.2 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.4.0)\nRequirement already satisfied: typing-extensions>=4.2 in /root/.local/lib/python3.10/site-packages (from aiosignal>=1.1.2->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.15.0)\nRequirement already satisfied: googleapis-common-protos<2.0.0,>=1.56.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.70.0)\nRequirement already satisfied: requests<3.0.0,>=2.18.0 in /usr/lib/python3/dist-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)\nRequirement already satisfied: grpcio<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.74.0)\nRequirement already satisfied: grpcio-status<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.62.3)\nRequirement already satisfied: cachetools<6.0,>=2.0.0 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (5.5.2)\nRequirement already satisfied: rsa<5,>=3.1.4 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.9.1)\nRequirement already satisfied: pyasn1-modules>=0.2.1 in /usr/lib/python3/dist-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.2.1)\nRequirement already satisfied: propcache>=0.2.1 in /root/.local/lib/python3.10/site-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (0.3.2)\nRequirement already satisfied: idna>=2.0 in /usr/lib/python3/dist-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (3.3)\nRequirement already satisfied: pyasn1>=0.1.3 in /usr/lib/python3/dist-packages (from rsa<5,>=3.1.4->google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.4.8)\n", "stdout_lines": ["Requirement already satisfied: discord.py==2.4.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 1)) (2.4.0)", "Requirement already satisfied: psycopg2-binary==2.9.9 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 2)) (2.9.9)", "Requirement already satisfied: python-dotenv==1.0.1 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 3)) (1.0.1)", "Requirement already satisfied: google-cloud-secret-manager==2.20.0 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 4)) (2.20.0)", "Requirement already satisfied: aiohttp==3.9.5 in /root/.local/lib/python3.10/site-packages (from -r /app/requirements.txt (line 5)) (3.9.5)", "Requirement already satisfied: google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.40.3)", "Requirement already satisfied: protobuf!=3.20.0,!=3.20.1,!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,<5.0.0dev,>=3.19.5 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.25.8)", "Requirement already satisfied: grpc-google-iam-v1<1.0.0dev,>=0.12.4 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.14.2)", "Requirement already satisfied: google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)", "Requirement already satisfied: proto-plus<2.0.0dev,>=1.22.3 in /root/.local/lib/python3.10/site-packages (from google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.26.1)", "Requirement already satisfied: attrs>=17.3.0 in /usr/lib/python3/dist-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (21.2.0)", "Requirement already satisfied: yarl<2.0,>=1.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.20.1)", "Requirement already satisfied: frozenlist>=1.1.1 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.7.0)", "Requirement already satisfied: multidict<7.0,>=4.5 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (6.6.4)", "Requirement already satisfied: async-timeout<5.0,>=4.0 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.0.3)", "Requirement already satisfied: aiosignal>=1.1.2 in /root/.local/lib/python3.10/site-packages (from aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (1.4.0)", "Requirement already satisfied: typing-extensions>=4.2 in /root/.local/lib/python3.10/site-packages (from aiosignal>=1.1.2->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (4.15.0)", "Requirement already satisfied: googleapis-common-protos<2.0.0,>=1.56.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.70.0)", "Requirement already satisfied: requests<3.0.0,>=2.18.0 in /usr/lib/python3/dist-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (2.25.1)", "Requirement already satisfied: grpcio<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.74.0)", "Requirement already satisfied: grpcio-status<2.0.0,>=1.33.2 in /root/.local/lib/python3.10/site-packages (from google-api-core[grpc]!=2.0.*,!=2.1.*,!=2.10.*,!=2.2.*,!=2.3.*,!=2.4.*,!=2.5.*,!=2.6.*,!=2.7.*,!=2.8.*,!=2.9.*,<3.0.0dev,>=1.34.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (1.62.3)", "Requirement already satisfied: cachetools<6.0,>=2.0.0 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (5.5.2)", "Requirement already satisfied: rsa<5,>=3.1.4 in /root/.local/lib/python3.10/site-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (4.9.1)", "Requirement already satisfied: pyasn1-modules>=0.2.1 in /usr/lib/python3/dist-packages (from google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.2.1)", "Requirement already satisfied: propcache>=0.2.1 in /root/.local/lib/python3.10/site-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (0.3.2)", "Requirement already satisfied: idna>=2.0 in /usr/lib/python3/dist-packages (from yarl<2.0,>=1.0->aiohttp==3.9.5->-r /app/requirements.txt (line 5)) (3.3)", "Requirement already satisfied: pyasn1>=0.1.3 in /usr/lib/python3/dist-packages (from rsa<5,>=3.1.4->google-auth!=2.24.0,!=2.25.0,<3.0.0dev,>=2.14.1->google-cloud-secret-manager==2.20.0->-r /app/requirements.txt (line 4)) (0.4.8)"], "version": null, "virtualenv": null***
2025-09-06T01:48:55.4864374Z 
2025-09-06T01:48:55.4864734Z TASK [Install additional packages] *********************************************
2025-09-06T01:49:07.4734018Z ok: [***] => ***"changed": false, "cmd": ["/usr/bin/pip3", "install", "--user", "psycopg2-binary"], "name": ["psycopg2-binary"], "requirements": null, "state": "present", "stderr": "WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\n", "stderr_lines": ["WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv"], "stdout": "Requirement already satisfied: psycopg2-binary in /root/.local/lib/python3.10/site-packages (2.9.9)\n", "stdout_lines": ["Requirement already satisfied: psycopg2-binary in /root/.local/lib/python3.10/site-packages (2.9.9)"], "version": null, "virtualenv": null***
2025-09-06T01:49:07.4738639Z 
2025-09-06T01:49:07.4739071Z TASK [Set up environment variables] ********************************************
2025-09-06T01:49:07.4967119Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/setup_environment.yml for ***
2025-09-06T01:49:07.4968168Z 
2025-09-06T01:49:07.4968620Z TASK [Create .env file] ********************************************************
2025-09-06T01:49:11.7025039Z changed: [***] => ***"changed": true, "checksum": "a974a4f3ee2ec4647427d36713d12cb9940147b7", "dest": "/app/.env", "gid": 1000, "group": "ubuntu", "md5sum": "87eb36bf35058f17fde58db0ef954cb3", "mode": "0600", "owner": "ubuntu", "size": 252, "src": "/home/ubuntu/.ansible/tmp/ansible-tmp-1757123347.6811268-3736-221493010653391/source", "state": "file", "uid": 1000***
2025-09-06T01:49:11.7026680Z 
2025-09-06T01:49:11.7027394Z TASK [Set PYTHONPATH environment variable] *************************************
2025-09-06T01:49:14.4941455Z ok: [***] => ***"backup": "", "changed": false, "msg": ""***
2025-09-06T01:49:14.4941965Z 
2025-09-06T01:49:14.4942951Z TASK [Test Python imports] *****************************************************
2025-09-06T01:49:24.7816294Z changed: [***] => ***"changed": true, "cmd": ["python3", "-c", "import sys; print('Python path:', sys.path); import src.participation_bot"], "delta": "0:00:07.523621", "end": "2025-09-06 01:49:24.485754", "failed_when_result": false, "msg": "", "rc": 0, "start": "2025-09-06 01:49:16.962133", "stderr": "", "stderr_lines": [], "stdout": "Python path: ['', '/app', '/app/$PYTHONPATH', '/usr/lib/python310.zip', '/usr/lib/python3.10', '/usr/lib/python3.10/lib-dynload', '/root/.local/lib/python3.10/site-packages', '/usr/local/lib/python3.10/dist-packages', '/usr/lib/python3/dist-packages']\nWarning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value", "stdout_lines": ["Python path: ['', '/app', '/app/$PYTHONPATH', '/usr/lib/python310.zip', '/usr/lib/python3.10', '/usr/lib/python3.10/lib-dynload', '/root/.local/lib/python3.10/site-packages', '/usr/local/lib/python3.10/dist-packages', '/usr/lib/python3/dist-packages']", "Warning: GITHUB_TOKEN not set or using dummy value", "Warning: WEBHOOK_URL not set or using default value", "Warning: UEX_API_KEY not set or using dummy value"]***
2025-09-06T01:49:24.7820501Z 
2025-09-06T01:49:24.7820814Z TASK [Start bot service] *******************************************************
2025-09-06T01:49:24.8073381Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/start_bot.yml for ***
2025-09-06T01:49:24.8074312Z 
2025-09-06T01:49:24.8074890Z TASK [Test Python imports before starting bot] *********************************
2025-09-06T01:49:32.9939670Z changed: [***] => ***"changed": true, "cmd": ["python3", "-c", "import src.participation_bot; print('Import successful')"], "delta": "0:00:05.243446", "end": "2025-09-06 01:49:32.701635", "msg": "", "rc": 0, "start": "2025-09-06 01:49:27.458189", "stderr": "", "stderr_lines": [], "stdout": "Warning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value\nImport successful", "stdout_lines": ["Warning: GITHUB_TOKEN not set or using dummy value", "Warning: WEBHOOK_URL not set or using default value", "Warning: UEX_API_KEY not set or using dummy value", "Import successful"]***
2025-09-06T01:49:32.9942135Z 
2025-09-06T01:49:32.9942494Z TASK [Show import test result] *************************************************
2025-09-06T01:49:33.0184064Z ok: [***] => ***
2025-09-06T01:49:33.0185312Z     "msg": "Import test result: Warning: GITHUB_TOKEN not set or using dummy value\nWarning: WEBHOOK_URL not set or using default value\nWarning: UEX_API_KEY not set or using dummy value\nImport successful"
2025-09-06T01:49:33.0188289Z ***
2025-09-06T01:49:33.0188517Z 
2025-09-06T01:49:33.0188838Z TASK [Start bot process] *******************************************************
2025-09-06T01:49:41.9864257Z changed: [***] => ***"changed": true, "cmd": "#!/bin/bash\ncd /app\nexport PYTHONPATH=\"/app:$PYTHONPATH\"\n\n# Load environment variables from .env file\nif [ -f .env ]; then\n  set -a  # automatically export all variables\n  . .env  # use . instead of source for compatibility\n  set +a\nfi\n\necho \"Starting bot with environment:\"\necho \"DISCORD_TOKEN: $***DISCORD_TOKEN:0:10***...\"\necho \"DATABASE_URL: $***DATABASE_URL:0:20***...\"\necho \"TEXT_CHANNEL_ID: $TEXT_CHANNEL_ID\"\necho \"PYTHONPATH: $PYTHONPATH\"\n\nnohup python3 -m src.participation_bot > /app/bot.log 2>&1 &\nBOT_PID=$!\necho $BOT_PID > /app/bot.pid\necho \"Bot started with PID: $BOT_PID\"\nsleep 2\n\nif kill -0 $BOT_PID 2>/dev/null; then\n  echo \"Bot process is running\"\nelse\n  echo \"Bot process failed to start or died immediately\"\n  if [ -f /app/bot.log ]; then\n    echo \"Bot log contents:\"\n    cat /app/bot.log\n  fi\nfi\n", "delta": "0:00:02.256243", "end": "2025-09-06 01:49:40.194534", "msg": "", "rc": 0, "start": "2025-09-06 01:49:37.938291", "stderr": "", "stderr_lines": [], "stdout": "Starting bot with environment:\nDISCORD_TOKEN: MTQxMTc4ND...\nDATABASE_URL: postgresql://event_u...\nTEXT_CHANNEL_ID: ***\nPYTHONPATH: /app:/app:$PYTHONPATH\nBot started with PID: 7411\nBot process is running", "stdout_lines": ["Starting bot with environment:", "DISCORD_TOKEN: MTQxMTc4ND...", "DATABASE_URL: postgresql://event_u...", "TEXT_CHANNEL_ID: ***", "PYTHONPATH: /app:/app:$PYTHONPATH", "Bot started with PID: 7411", "Bot process is running"]***
2025-09-06T01:49:41.9873501Z 
2025-09-06T01:49:41.9874069Z TASK [Show startup debug info] *************************************************
2025-09-06T01:49:42.0106706Z ok: [***] => ***
2025-09-06T01:49:42.0107680Z     "msg": [
2025-09-06T01:49:42.0108430Z         "Starting bot with environment:",
2025-09-06T01:49:42.0109335Z         "DISCORD_TOKEN: MTQxMTc4ND...",
2025-09-06T01:49:42.0110267Z         "DATABASE_URL: postgresql://event_u...",
2025-09-06T01:49:42.0111231Z         "TEXT_CHANNEL_ID: ***",
2025-09-06T01:49:42.0112077Z         "PYTHONPATH: /app:/app:$PYTHONPATH",
2025-09-06T01:49:42.0112986Z         "Bot started with PID: 7411",
2025-09-06T01:49:42.0113803Z         "Bot process is running"
2025-09-06T01:49:42.0114569Z     ]
2025-09-06T01:49:42.0115603Z ***
2025-09-06T01:49:42.0116222Z 
2025-09-06T01:49:42.0134197Z TASK [Wait for bot to start] ***************************************************
2025-09-06T01:49:45.0328577Z Pausing for 3 seconds
2025-09-06T01:49:45.0329847Z ok: [***] => ***"changed": false, "delta": 3, "echo": true, "rc": 0, "start": "2025-09-06 01:49:42.021676", "stderr": "", "stdout": "Paused for 3.0 seconds", "stop": "2025-09-06 01:49:45.023706", "user_input": ""***
2025-09-06T01:49:45.0330675Z 
2025-09-06T01:49:45.0331035Z TASK [Verify bot process is running] *******************************************
2025-09-06T01:49:48.0124844Z changed: [***] => ***"changed": true, "cmd": "#!/bin/bash\nif [ -f \"/app/bot.pid\" ]; then\n  kill -0 $(cat /app/bot.pid) 2>/dev/null\nelse\n  exit 1\nfi\n", "delta": "0:00:00.009082", "end": "2025-09-06 01:49:47.718302", "failed_when_result": false, "msg": "", "rc": 0, "start": "2025-09-06 01:49:47.709220", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []***
2025-09-06T01:49:48.0126084Z 
2025-09-06T01:49:48.0126419Z TASK [Show bot log if startup failed] ******************************************
2025-09-06T01:49:48.0431896Z skipping: [***] => ***"changed": false, "false_condition": "(bot_check is defined and (bot_check.rc | default(0)) != 0 and not ansible_check_mode) or (ansible_check_mode and false)", "skip_reason": "Conditional result was False"***
2025-09-06T01:49:48.0433428Z 
2025-09-06T01:49:48.0434257Z TASK [Fail with bot log] *******************************************************
2025-09-06T01:49:48.0739156Z skipping: [***] => ***"changed": false, "false_condition": "(bot_check is defined and (bot_check.rc | default(0)) != 0 and not ansible_check_mode) or (ansible_check_mode and false)", "skip_reason": "Conditional result was False"***
2025-09-06T01:49:48.0740733Z 
2025-09-06T01:49:48.0741256Z TASK [Verify bot is running] ***************************************************
2025-09-06T01:49:48.1006993Z included: /home/runner/work/red-legion-bots/red-legion-bots/ansible/tasks/verify_bot.yml for ***
2025-09-06T01:49:48.1007944Z 
2025-09-06T01:49:48.1008479Z TASK [Check if bot PID file exists] ********************************************
2025-09-06T01:49:50.7404553Z ok: [***] => ***"changed": false, "stat": ***"atime": 1757123387.7164652, "attr_flags": "e", "attributes": ["extents"], "block_size": 4096, "blocks": 8, "charset": "us-ascii", "checksum": "081678ad6a977254b2dc64486e5f50bcaed2ba7f", "ctime": 1757123377.945668, "dev": 2049, "device_type": 0, "executable": false, "exists": true, "gid": 0, "gr_name": "root", "inode": 774213, "isblk": false, "ischr": false, "isdir": false, "isfifo": false, "isgid": false, "islnk": false, "isreg": true, "issock": false, "isuid": false, "mimetype": "text/plain", "mode": "0644", "mtime": 1757123377.945668, "nlink": 1, "path": "/app/bot.pid", "pw_name": "root", "readable": true, "rgrp": true, "roth": true, "rusr": true, "size": 5, "uid": 0, "version": "4267912978", "wgrp": false, "woth": false, "writeable": true, "wusr": true, "xgrp": false, "xoth": false, "xusr": false***
2025-09-06T01:49:50.7407634Z 
2025-09-06T01:49:50.7407980Z TASK [Verify bot process is running] *******************************************
2025-09-06T01:49:52.9694120Z changed: [***] => ***"changed": true, "cmd": "kill -0 $(cat /app/bot.pid)", "delta": "0:00:00.007014", "end": "2025-09-06 01:49:52.220305", "failed_when_result": false, "msg": "", "rc": 0, "start": "2025-09-06 01:49:52.213291", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []***
2025-09-06T01:49:52.9695199Z 
2025-09-06T01:49:52.9695544Z TASK [Check bot log for errors] ************************************************
2025-09-06T01:49:55.2727591Z changed: [***] => ***"changed": true, "cmd": ["tail", "-20", "/app/bot.log"], "delta": "0:00:00.007573", "end": "2025-09-06 01:49:54.990676", "msg": "", "rc": 0, "start": "2025-09-06 01:49:54.983103", "stderr": "", "stderr_lines": [], "stdout": "[2025-09-06 01:49:42] [INFO    ] discord.client: logging in using static token\n[2025-09-06 01:49:43] [INFO    ] discord.gateway: Shard ID None has connected to Gateway (Session ID: 1818468858904ebe94a2d3148fa286da).", "stdout_lines": ["[2025-09-06 01:49:42] [INFO    ] discord.client: logging in using static token", "[2025-09-06 01:49:43] [INFO    ] discord.gateway: Shard ID None has connected to Gateway (Session ID: 1818468858904ebe94a2d3148fa286da)."]***
2025-09-06T01:49:55.2731005Z 
2025-09-06T01:49:55.2731545Z TASK [Display recent log entries] **********************************************
2025-09-06T01:49:55.2976576Z ok: [***] => ***
2025-09-06T01:49:55.2978616Z     "msg": "[2025-09-06 01:49:42] [INFO    ] discord.client: logging in using static token\n[2025-09-06 01:49:43] [INFO    ] discord.gateway: Shard ID None has connected to Gateway (Session ID: 1818468858904ebe94a2d3148fa286da)."
2025-09-06T01:49:55.2980336Z ***
2025-09-06T01:49:55.2980690Z 
2025-09-06T01:49:55.2981244Z TASK [Check for error patterns in log] *****************************************
2025-09-06T01:49:58.2208807Z changed: [***] => ***"changed": true, "cmd": "grep -i \"ERROR\\|Exception\\|Failed\" /app/bot.log", "delta": "0:00:00.010612", "end": "2025-09-06 01:49:57.959723", "failed_when_result": false, "msg": "non-zero return code", "rc": 1, "start": "2025-09-06 01:49:57.949111", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []***
2025-09-06T01:49:58.2209942Z 
2025-09-06T01:49:58.2210256Z TASK [Read PID from file] ******************************************************
2025-09-06T01:50:01.0055861Z ok: [***] => ***"changed": false, "content": "NzQxMQo=", "encoding": "base64", "source": "/app/bot.pid"***
2025-09-06T01:50:01.0056751Z 
2025-09-06T01:50:01.0057489Z TASK [Report successful deployment] ********************************************
2025-09-06T01:50:01.0422973Z ok: [***] => ***
2025-09-06T01:50:01.0424166Z     "msg": "✅ Bot deployment successful! PID: 7411"
2025-09-06T01:50:01.0425103Z ***
2025-09-06T01:50:01.0425456Z 
2025-09-06T01:50:01.0425944Z TASK [Remove PID file] *********************************************************
2025-09-06T01:50:04.0179080Z changed: [***] => ***"changed": true, "path": "/app/bot.pid", "state": "absent"***
2025-09-06T01:50:04.0179606Z 
2025-09-06T01:50:04.0179951Z TASK [Clean up temporary files] ************************************************
2025-09-06T01:50:10.5505898Z changed: [***] => (item=/app/.git) => ***"ansible_loop_var": "item", "changed": true, "item": "/app/.git", "path": "/app/.git", "state": "absent"***
2025-09-06T01:50:10.5507773Z changed: [***] => (item=/app/ansible) => ***"ansible_loop_var": "item", "changed": true, "item": "/app/ansible", "path": "/app/ansible", "state": "absent"***
2025-09-06T01:50:10.5509166Z changed: [***] => (item=/app/tests) => ***"ansible_loop_var": "item", "changed": true, "item": "/app/tests", "path": "/app/tests", "state": "absent"***
2025-09-06T01:50:10.5510340Z 
2025-09-06T01:50:10.5510645Z PLAY RECAP *********************************************************************
2025-09-06T01:50:10.5511499Z ***               : ok=39   changed=18   unreachable=0    failed=0    skipped=3    rescued=0    ignored=2   
2025-09-06T01:50:10.5512009Z 
2025-09-06T01:50:10.5967660Z === Ansible deployment completed ===
2025-09-06T01:50:10.5968826Z === Waiting for bot to stabilize ===
2025-09-06T01:50:20.5989440Z === Bot startup wait completed ===
