2025-09-07T16:10:19.8073379Z ##[group]Run actions/github-script@v7
2025-09-07T16:10:19.8073983Z with:
2025-09-07T16:10:19.8074881Z   github-token: ***
2025-09-07T16:10:19.8078754Z   script: try {
  // Get PR details for merge
  const pr = await github.rest.pulls.get({
    owner: context.repo.owner,
    repo: context.repo.repo,
    pull_number: context.payload.pull_request.number
  });
  
  // Merge the pull request
  await github.rest.pulls.merge({
    owner: context.repo.owner,
    repo: context.repo.repo,
    pull_number: context.payload.pull_request.number,
    commit_title: `Deploy: ${pr.data.title}`,
    commit_message: `Deployment successful for PR #${context.payload.pull_request.number}\n\n${pr.data.body || 'No description provided'}`,
    merge_method: 'squash'
  });
  console.log('✅ Pull request merged successfully');
} catch (error) {
  console.error('❌ Failed to merge pull request:', error.message);
  throw error;
}

2025-09-07T16:10:19.8083137Z   debug: false
2025-09-07T16:10:19.8083595Z   user-agent: actions/github-script
2025-09-07T16:10:19.8084162Z   result-encoding: json
2025-09-07T16:10:19.8084852Z   retries: 0
2025-09-07T16:10:19.8085312Z   retry-exempt-status-codes: 400,401,403,404,422
2025-09-07T16:10:19.8085861Z ##[endgroup]
2025-09-07T16:10:22.0466415Z ❌ Failed to merge pull request: Repository rule violations found
2025-09-07T16:10:22.0467234Z 
2025-09-07T16:10:22.0507250Z A conversation must be resolved before this pull request can be merged.
2025-09-07T16:10:22.0507919Z 
2025-09-07T16:10:22.0508279Z CodeQL has detected 3 alerts blocking this code from being merged.
2025-09-07T16:10:22.0509427Z 
2025-09-07T16:10:22.0509474Z 
2025-09-07T16:10:22.0509814Z RequestError [HttpError]: Repository rule violations found
2025-09-07T16:10:22.0510322Z 
2025-09-07T16:10:22.0510732Z A conversation must be resolved before this pull request can be merged.
2025-09-07T16:10:22.0511335Z 
2025-09-07T16:10:22.0511704Z CodeQL has detected 3 alerts blocking this code from being merged.
2025-09-07T16:10:22.0512209Z 
2025-09-07T16:10:22.0512261Z 
2025-09-07T16:10:22.0512647Z     at /home/runner/work/_actions/actions/github-script/v7/dist/index.js:9537:21
2025-09-07T16:10:22.0513565Z     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
2025-09-07T16:10:22.0515074Z     at async eval (eval at callAsyncFunction (/home/runner/work/_actions/actions/github-script/v7/dist/index.js:36187:16), <anonymous>:12:3)
2025-09-07T16:10:22.0516384Z     at async main (/home/runner/work/_actions/actions/github-script/v7/dist/index.js:36285:20) {
2025-09-07T16:10:22.0517171Z   status: 405,
2025-09-07T16:10:22.0517543Z   response: {
2025-09-07T16:10:22.0518430Z     url: 'https://api.github.com/repos/The-Red-Legion/red-legion-bots/pulls/50/merge',
2025-09-07T16:10:22.0519166Z     status: 405,
2025-09-07T16:10:22.0519566Z     headers: {
2025-09-07T16:10:22.0519984Z       'access-control-allow-origin': '*',
2025-09-07T16:10:22.0522185Z       'access-control-expose-headers': 'ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, X-GitHub-SSO, X-GitHub-Request-Id, Deprecation, Sunset',
2025-09-07T16:10:22.0524307Z       'content-length': '294',
2025-09-07T16:10:22.0525030Z       'content-security-policy': "default-src 'none'",
2025-09-07T16:10:22.0525656Z       'content-type': 'application/json; charset=utf-8',
2025-09-07T16:10:22.0526246Z       date: 'Sun, 07 Sep 2025 16:10:22 GMT',
2025-09-07T16:10:22.0527021Z       'referrer-policy': 'origin-when-cross-origin, strict-origin-when-cross-origin',
2025-09-07T16:10:22.0527785Z       server: 'github.com',
2025-09-07T16:10:22.0528441Z       'strict-transport-security': 'max-age=31536000; includeSubdomains; preload',
2025-09-07T16:10:22.0529234Z       vary: 'Accept-Encoding, Accept, X-Requested-With',
2025-09-07T16:10:22.0529865Z       'x-accepted-github-permissions': 'contents=write',
2025-09-07T16:10:22.0530467Z       'x-content-type-options': 'nosniff',
2025-09-07T16:10:22.0531265Z       'x-frame-options': 'deny',
2025-09-07T16:10:22.0531790Z       'x-github-api-version-selected': '2022-11-28',
2025-09-07T16:10:22.0532381Z       'x-github-media-type': 'github.v3; format=json',
2025-09-07T16:10:22.0533067Z       'x-github-request-id': 'EC01:3092AB:4431CDC:467FD08:68BDAE6C',
2025-09-07T16:10:22.0533671Z       'x-ratelimit-limit': '5000',
2025-09-07T16:10:22.0534144Z       'x-ratelimit-remaining': '4998',
2025-09-07T16:10:22.0534890Z       'x-ratelimit-reset': '1757265020',
2025-09-07T16:10:22.0535432Z       'x-ratelimit-resource': 'core',
2025-09-07T16:10:22.0535915Z       'x-ratelimit-used': '2',
2025-09-07T16:10:22.0536374Z       'x-xss-protection': '0'
2025-09-07T16:10:22.0536764Z     },
2025-09-07T16:10:22.0537119Z     data: {
2025-09-07T16:10:22.0537555Z       message: 'Repository rule violations found\n' +
2025-09-07T16:10:22.0538088Z         '\n' +
2025-09-07T16:10:22.0538605Z         'A conversation must be resolved before this pull request can be merged.\n' +
2025-09-07T16:10:22.0539031Z         '\n' +
2025-09-07T16:10:22.0539364Z         'CodeQL has detected 3 alerts blocking this code from being merged.\n' +
2025-09-07T16:10:22.0539746Z         '\n',
2025-09-07T16:10:22.0540146Z       documentation_url: 'https://docs.github.com/rest/pulls/pulls#merge-a-pull-request',
2025-09-07T16:10:22.0540581Z       status: '405'
2025-09-07T16:10:22.0540798Z     }
2025-09-07T16:10:22.0540988Z   },
2025-09-07T16:10:22.0541186Z   request: {
2025-09-07T16:10:22.0541639Z     method: 'PUT',
2025-09-07T16:10:22.0542043Z     url: 'https://api.github.com/repos/The-Red-Legion/red-legion-bots/pulls/50/merge',
2025-09-07T16:10:22.0542488Z     headers: {
2025-09-07T16:10:22.0542745Z       accept: 'application/vnd.github.v3+json',
2025-09-07T16:10:22.0543214Z       'user-agent': 'actions/github-script octokit-core.js/5.0.1 Node.js/20.19.4 (linux; x64)',
2025-09-07T16:10:22.0543673Z       authorization: 'token [REDACTED]',
2025-09-07T16:10:22.0544011Z       'content-type': 'application/json; charset=utf-8'
2025-09-07T16:10:22.0544667Z     },
2025-09-07T16:10:22.0563681Z     body: '{"commit_title":"Deploy: Complete Red Legion Bot Codebase Reorganization and Audit Fixes","commit_message":"Deployment successful for PR #50\\n\\n## 🚀 Complete Codebase Reorganization\\n\\nThis PR implements a comprehensive reorganization of the Red Legion Discord Bot codebase, addressing all 4 critical audit issues and establishing a clean, modular architecture.\\n\\n### 📋 **Audit Issues Resolved:**\\n\\n1. ✅ **Code Organization** - Restructured entire codebase into logical modules\\n2. ✅ **Import Management** - Fixed all circular imports and dependency issues  \\n3. ✅ **Error Handling** - Enhanced error handling with decorators and retry logic\\n4. ✅ **Documentation** - Updated all documentation and workflow files\\n\\n### 🏗️ **New Modular Structure:**\\n\\n```\\nsrc/\\n├── main.py              # Clean entry point (replaces participation_bot.py)\\n├── config/              # Configuration management\\n│   ├── settings.py      # Bot settings and environment\\n│   └── channels.py      # Channel configurations\\n├── core/                # Core bot functionality\\n│   ├── bot_setup.py     # Bot initialization and setup\\n│   └── decorators.py    # Reusable decorators\\n├── commands/            # Command modules\\n│   ├── admin/           # Admin-only commands\\n│   ├── mining/          # Mining-related commands\\n│   ├── general.py       # General purpose commands\\n│   ├── market.py        # Market functionality\\n│   ├── loans.py         # Loan management\\n│   └── events.py        # Event commands\\n├── handlers/            # Event handlers\\n│   ├── core.py          # Core event handling\\n│   └── voice_tracking.py # Voice channel tracking\\n├── database/            # Database layer\\n│   ├── models.py        # Database models\\n│   └── operations.py    # Database operations\\n├── bot/                 # Bot utilities\\n│   ├── client.py        # Bot client setup\\n│   └── utils.py         # Bot helper functions\\n└── utils/               # General utilities\\n    ├── decorators.py    # Utility decorators\\n    └── discord_helpers.py # Discord API helpers\\n```\\n\\n### 🔧 **Infrastructure Updates:**\\n\\n- **GitHub Workflows**: Updated `.github/workflows/test.yml` for new structure\\n- **Ansible Deployment**: Updated deployment configurations\\n- **Test Framework**: Fixed all compatibility issues (15/15 tests passing)\\n- **Documentation**: Comprehensive updates to README and docs\\n\\n### 🧪 **Testing:**\\n\\n- ✅ All 15 tests passing\\n- ✅ Full compatibility with existing functionality  \\n- ✅ Proper module imports and dependencies\\n- ✅ Database schema validation\\n- ✅ Command registration verification\\n\\n### 🚀 **Benefits:**\\n\\n- **Maintainability**: Clear separation of concerns\\n- **Scalability**: Easy to add new features and modules\\n- **Testability**: Comprehensive test coverage\\n- **Deployment**: Streamlined CI/CD with updated workflows\\n- **Documentation**: Better code organization and documentation\\n\\n### 📝 **Migration Notes:**\\n\\n- Entry point changed from `participation_bot.py` to `src/main.py`\\n- All imports updated to use new modular structure\\n- Database schema enhanced with additional tables\\n- Test framework updated for new architecture\\n\\nReady for production deployment! 🎉","merge_method":"squash"}',
2025-09-07T16:10:22.0578747Z     request: {
2025-09-07T16:10:22.0579028Z       agent: [Agent],
2025-09-07T16:10:22.0579288Z       fetch: [Function: proxyFetch],
2025-09-07T16:10:22.0579837Z       hook: [Function: bound bound register]
2025-09-07T16:10:22.0580132Z     }
2025-09-07T16:10:22.0580327Z   }
2025-09-07T16:10:22.0580524Z }
2025-09-07T16:10:22.0610377Z ##[error]Unhandled error: HttpError: Repository rule violations found

A conversation must be resolved before this pull request can be merged.

CodeQL has detected 3 alerts blocking this code from being merged.


