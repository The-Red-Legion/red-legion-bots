2025-09-07T16:10:18.5875026Z Current runner version: '2.328.0'
2025-09-07T16:10:18.5898648Z ##[group]Runner Image Provisioner
2025-09-07T16:10:18.5899483Z Hosted Compute Agent
2025-09-07T16:10:18.5900007Z Version: 20250829.383
2025-09-07T16:10:18.5900730Z Commit: 27cb235aab5b0e52e153a26cd86b4742e89dac5d
2025-09-07T16:10:18.5901400Z Build Date: 2025-08-29T13:48:48Z
2025-09-07T16:10:18.5902005Z ##[endgroup]
2025-09-07T16:10:18.5902572Z ##[group]Operating System
2025-09-07T16:10:18.5903167Z Ubuntu
2025-09-07T16:10:18.5903616Z 24.04.3
2025-09-07T16:10:18.5904121Z LTS
2025-09-07T16:10:18.5904808Z ##[endgroup]
2025-09-07T16:10:18.5905319Z ##[group]Runner Image
2025-09-07T16:10:18.5905945Z Image: ubuntu-24.04
2025-09-07T16:10:18.5906435Z Version: 20250831.1.0
2025-09-07T16:10:18.5907443Z Included Software: https://github.com/actions/runner-images/blob/ubuntu24/20250831.1/images/ubuntu/Ubuntu2404-Readme.md
2025-09-07T16:10:18.5908979Z Image Release: https://github.com/actions/runner-images/releases/tag/ubuntu24%2F20250831.1
2025-09-07T16:10:18.5909935Z ##[endgroup]
2025-09-07T16:10:18.5911324Z ##[group]GITHUB_TOKEN Permissions
2025-09-07T16:10:18.5913174Z Actions: read
2025-09-07T16:10:18.5913738Z Checks: read
2025-09-07T16:10:18.5914308Z Contents: write
2025-09-07T16:10:18.5915034Z Issues: write
2025-09-07T16:10:18.5915533Z Metadata: read
2025-09-07T16:10:18.5916124Z PullRequests: write
2025-09-07T16:10:18.5916634Z ##[endgroup]
2025-09-07T16:10:18.5918605Z Secret source: Actions
2025-09-07T16:10:18.5919404Z Prepare workflow directory
2025-09-07T16:10:18.6238595Z Prepare all required actions
2025-09-07T16:10:18.6276218Z Getting action download info
2025-09-07T16:10:19.0386203Z Download action repository 'actions/github-script@v7' (SHA:f28e40c7f34bde8b3046d885e986cb6290c5673b)
2025-09-07T16:10:19.7108590Z Complete job name: post-deployment
2025-09-07T16:10:19.7737120Z ##[group]Run if [ "success" == "success" ]; then
2025-09-07T16:10:19.7737862Z [36;1mif [ "success" == "success" ]; then[0m
2025-09-07T16:10:19.7738509Z [36;1m  echo "✅ Deployment job completed successfully"[0m
2025-09-07T16:10:19.7739094Z [36;1melse[0m
2025-09-07T16:10:19.7739512Z [36;1m  echo "❌ Deployment job failed"[0m
2025-09-07T16:10:19.7740210Z [36;1m  echo "Check the deployment logs above for detailed error information"[0m
2025-09-07T16:10:19.7740875Z [36;1mfi[0m
2025-09-07T16:10:19.7798928Z shell: /usr/bin/bash -e {0}
2025-09-07T16:10:19.7799704Z ##[endgroup]
2025-09-07T16:10:19.7921500Z ✅ Deployment job completed successfully
2025-09-07T16:10:19.8073401Z ##[group]Run actions/github-script@v7
2025-09-07T16:10:19.8073987Z with:
2025-09-07T16:10:19.8074887Z   github-token: ***
2025-09-07T16:10:19.8078805Z   script: try {
  // Get PR details for merge
  const pr = await github.rest.pulls.get({
    owner: context.repo.owner,
    repo: context.repo.repo,
    pull_number: context.payload.pull_request.number
  });
  
  // Merge the pull request
  await github.rest.pulls.merge({
    owner: context.repo.owner,
    repo: context.repo.repo,
    pull_number: context.payload.pull_request.number,
    commit_title: `Deploy: ${pr.data.title}`,
    commit_message: `Deployment successful for PR #${context.payload.pull_request.number}\n\n${pr.data.body || 'No description provided'}`,
    merge_method: 'squash'
  });
  console.log('✅ Pull request merged successfully');
} catch (error) {
  console.error('❌ Failed to merge pull request:', error.message);
  throw error;
}

2025-09-07T16:10:19.8083146Z   debug: false
2025-09-07T16:10:19.8083636Z   user-agent: actions/github-script
2025-09-07T16:10:19.8084166Z   result-encoding: json
2025-09-07T16:10:19.8084857Z   retries: 0
2025-09-07T16:10:19.8085315Z   retry-exempt-status-codes: 400,401,403,404,422
2025-09-07T16:10:19.8085864Z ##[endgroup]
2025-09-07T16:10:22.0466526Z ❌ Failed to merge pull request: Repository rule violations found
2025-09-07T16:10:22.0467242Z 
2025-09-07T16:10:22.0507300Z A conversation must be resolved before this pull request can be merged.
2025-09-07T16:10:22.0507941Z 
2025-09-07T16:10:22.0508288Z CodeQL has detected 3 alerts blocking this code from being merged.
2025-09-07T16:10:22.0509458Z 
2025-09-07T16:10:22.0509479Z 
2025-09-07T16:10:22.0509827Z RequestError [HttpError]: Repository rule violations found
2025-09-07T16:10:22.0510337Z 
2025-09-07T16:10:22.0510745Z A conversation must be resolved before this pull request can be merged.
2025-09-07T16:10:22.0511353Z 
2025-09-07T16:10:22.0511713Z CodeQL has detected 3 alerts blocking this code from being merged.
2025-09-07T16:10:22.0512253Z 
2025-09-07T16:10:22.0512272Z 
2025-09-07T16:10:22.0512670Z     at /home/runner/work/_actions/actions/github-script/v7/dist/index.js:9537:21
2025-09-07T16:10:22.0513578Z     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
2025-09-07T16:10:22.0515095Z     at async eval (eval at callAsyncFunction (/home/runner/work/_actions/actions/github-script/v7/dist/index.js:36187:16), <anonymous>:12:3)
2025-09-07T16:10:22.0516397Z     at async main (/home/runner/work/_actions/actions/github-script/v7/dist/index.js:36285:20) {
2025-09-07T16:10:22.0517180Z   status: 405,
2025-09-07T16:10:22.0517549Z   response: {
2025-09-07T16:10:22.0518443Z     url: 'https://api.github.com/repos/The-Red-Legion/red-legion-bots/pulls/50/merge',
2025-09-07T16:10:22.0519173Z     status: 405,
2025-09-07T16:10:22.0519573Z     headers: {
2025-09-07T16:10:22.0519991Z       'access-control-allow-origin': '*',
2025-09-07T16:10:22.0522211Z       'access-control-expose-headers': 'ETag, Link, Location, Retry-After, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Used, X-RateLimit-Resource, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval, X-GitHub-Media-Type, X-GitHub-SSO, X-GitHub-Request-Id, Deprecation, Sunset',
2025-09-07T16:10:22.0524315Z       'content-length': '294',
2025-09-07T16:10:22.0525041Z       'content-security-policy': "default-src 'none'",
2025-09-07T16:10:22.0525663Z       'content-type': 'application/json; charset=utf-8',
2025-09-07T16:10:22.0526252Z       date: 'Sun, 07 Sep 2025 16:10:22 GMT',
2025-09-07T16:10:22.0527029Z       'referrer-policy': 'origin-when-cross-origin, strict-origin-when-cross-origin',
2025-09-07T16:10:22.0527793Z       server: 'github.com',
2025-09-07T16:10:22.0528449Z       'strict-transport-security': 'max-age=31536000; includeSubdomains; preload',
2025-09-07T16:10:22.0529241Z       vary: 'Accept-Encoding, Accept, X-Requested-With',
2025-09-07T16:10:22.0529871Z       'x-accepted-github-permissions': 'contents=write',
2025-09-07T16:10:22.0530746Z       'x-content-type-options': 'nosniff',
2025-09-07T16:10:22.0531272Z       'x-frame-options': 'deny',
2025-09-07T16:10:22.0531796Z       'x-github-api-version-selected': '2022-11-28',
2025-09-07T16:10:22.0532386Z       'x-github-media-type': 'github.v3; format=json',
2025-09-07T16:10:22.0533073Z       'x-github-request-id': 'EC01:3092AB:4431CDC:467FD08:68BDAE6C',
2025-09-07T16:10:22.0533677Z       'x-ratelimit-limit': '5000',
2025-09-07T16:10:22.0534150Z       'x-ratelimit-remaining': '4998',
2025-09-07T16:10:22.0534901Z       'x-ratelimit-reset': '1757265020',
2025-09-07T16:10:22.0535438Z       'x-ratelimit-resource': 'core',
2025-09-07T16:10:22.0535923Z       'x-ratelimit-used': '2',
2025-09-07T16:10:22.0536381Z       'x-xss-protection': '0'
2025-09-07T16:10:22.0536769Z     },
2025-09-07T16:10:22.0537126Z     data: {
2025-09-07T16:10:22.0537565Z       message: 'Repository rule violations found\n' +
2025-09-07T16:10:22.0538098Z         '\n' +
2025-09-07T16:10:22.0538628Z         'A conversation must be resolved before this pull request can be merged.\n' +
2025-09-07T16:10:22.0539035Z         '\n' +
2025-09-07T16:10:22.0539367Z         'CodeQL has detected 3 alerts blocking this code from being merged.\n' +
2025-09-07T16:10:22.0539749Z         '\n',
2025-09-07T16:10:22.0540149Z       documentation_url: 'https://docs.github.com/rest/pulls/pulls#merge-a-pull-request',
2025-09-07T16:10:22.0540584Z       status: '405'
2025-09-07T16:10:22.0540802Z     }
2025-09-07T16:10:22.0540991Z   },
2025-09-07T16:10:22.0541189Z   request: {
2025-09-07T16:10:22.0541643Z     method: 'PUT',
2025-09-07T16:10:22.0542047Z     url: 'https://api.github.com/repos/The-Red-Legion/red-legion-bots/pulls/50/merge',
2025-09-07T16:10:22.0542492Z     headers: {
2025-09-07T16:10:22.0542749Z       accept: 'application/vnd.github.v3+json',
2025-09-07T16:10:22.0543227Z       'user-agent': 'actions/github-script octokit-core.js/5.0.1 Node.js/20.19.4 (linux; x64)',
2025-09-07T16:10:22.0543677Z       authorization: 'token [REDACTED]',
2025-09-07T16:10:22.0544023Z       'content-type': 'application/json; charset=utf-8'
2025-09-07T16:10:22.0544683Z     },
2025-09-07T16:10:22.0563996Z     body: '{"commit_title":"Deploy: Complete Red Legion Bot Codebase Reorganization and Audit Fixes","commit_message":"Deployment successful for PR #50\\n\\n## 🚀 Complete Codebase Reorganization\\n\\nThis PR implements a comprehensive reorganization of the Red Legion Discord Bot codebase, addressing all 4 critical audit issues and establishing a clean, modular architecture.\\n\\n### 📋 **Audit Issues Resolved:**\\n\\n1. ✅ **Code Organization** - Restructured entire codebase into logical modules\\n2. ✅ **Import Management** - Fixed all circular imports and dependency issues  \\n3. ✅ **Error Handling** - Enhanced error handling with decorators and retry logic\\n4. ✅ **Documentation** - Updated all documentation and workflow files\\n\\n### 🏗️ **New Modular Structure:**\\n\\n```\\nsrc/\\n├── main.py              # Clean entry point (replaces participation_bot.py)\\n├── config/              # Configuration management\\n│   ├── settings.py      # Bot settings and environment\\n│   └── channels.py      # Channel configurations\\n├── core/                # Core bot functionality\\n│   ├── bot_setup.py     # Bot initialization and setup\\n│   └── decorators.py    # Reusable decorators\\n├── commands/            # Command modules\\n│   ├── admin/           # Admin-only commands\\n│   ├── mining/          # Mining-related commands\\n│   ├── general.py       # General purpose commands\\n│   ├── market.py        # Market functionality\\n│   ├── loans.py         # Loan management\\n│   └── events.py        # Event commands\\n├── handlers/            # Event handlers\\n│   ├── core.py          # Core event handling\\n│   └── voice_tracking.py # Voice channel tracking\\n├── database/            # Database layer\\n│   ├── models.py        # Database models\\n│   └── operations.py    # Database operations\\n├── bot/                 # Bot utilities\\n│   ├── client.py        # Bot client setup\\n│   └── utils.py         # Bot helper functions\\n└── utils/               # General utilities\\n    ├── decorators.py    # Utility decorators\\n    └── discord_helpers.py # Discord API helpers\\n```\\n\\n### 🔧 **Infrastructure Updates:**\\n\\n- **GitHub Workflows**: Updated `.github/workflows/test.yml` for new structure\\n- **Ansible Deployment**: Updated deployment configurations\\n- **Test Framework**: Fixed all compatibility issues (15/15 tests passing)\\n- **Documentation**: Comprehensive updates to README and docs\\n\\n### 🧪 **Testing:**\\n\\n- ✅ All 15 tests passing\\n- ✅ Full compatibility with existing functionality  \\n- ✅ Proper module imports and dependencies\\n- ✅ Database schema validation\\n- ✅ Command registration verification\\n\\n### 🚀 **Benefits:**\\n\\n- **Maintainability**: Clear separation of concerns\\n- **Scalability**: Easy to add new features and modules\\n- **Testability**: Comprehensive test coverage\\n- **Deployment**: Streamlined CI/CD with updated workflows\\n- **Documentation**: Better code organization and documentation\\n\\n### 📝 **Migration Notes:**\\n\\n- Entry point changed from `participation_bot.py` to `src/main.py`\\n- All imports updated to use new modular structure\\n- Database schema enhanced with additional tables\\n- Test framework updated for new architecture\\n\\nReady for production deployment! 🎉","merge_method":"squash"}',
2025-09-07T16:10:22.0578772Z     request: {
2025-09-07T16:10:22.0579032Z       agent: [Agent],
2025-09-07T16:10:22.0579292Z       fetch: [Function: proxyFetch],
2025-09-07T16:10:22.0579843Z       hook: [Function: bound bound register]
2025-09-07T16:10:22.0580135Z     }
2025-09-07T16:10:22.0580330Z   }
2025-09-07T16:10:22.0580526Z }
2025-09-07T16:10:22.0610419Z ##[error]Unhandled error: HttpError: Repository rule violations found

A conversation must be resolved before this pull request can be merged.

CodeQL has detected 3 alerts blocking this code from being merged.


2025-09-07T16:10:22.0684009Z Cleaning up orphan processes
